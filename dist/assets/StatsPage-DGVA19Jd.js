import{j as e,D as X,i as oe,g as xe,t as me}from"./index-CCbUoBqx.js";import{r as N,b as ge}from"./vendor-CDaM45aE.js";import{S as he}from"./Section-C4rNDtzF.js";import{S as ue}from"./ShareButtons-Cfi9Uw4o.js";import{R as pe,A as fe,C as be,X as je,Y as ve,T as Ne,c as ye}from"./charts-JFlVFhs5.js";import{M as we}from"./Modal-DsPBnX54.js";import{b as ke,s as T,I as Ae}from"./names-DeuIsqgk.js";import{c as Me}from"./router-ClepU2oc.js";import"./firebase-oRQd-T1V.js";const K={default:"",success:"text-emerald-500 dark:text-emerald-400",danger:"text-rose-500 dark:text-rose-400",warning:"text-amber-500 dark:text-amber-400",info:"text-blue-500 dark:text-blue-400",primary:"text-emerald-600 dark:text-emerald-400"},ee={sm:"text-xl",md:"text-2xl",lg:"text-3xl",xl:"text-4xl"};function $e({label:b,value:y,subtitle:A,trend:R,color:I="default",size:d="lg",variant:M="default",icon:i,T:w}){const B=K[I]||K.default,F=ee[d]||ee.lg,C=v=>v>0?"↗":v<0?"↘":"→",V=v=>v>0?"text-emerald-500":v<0?"text-rose-500":"text-gray-500",P={default:w.card,compact:`${w.borderMd} ${w.cardBg} ${w.border} ${w.spacingSm}`,elevated:w.cardHover};return e.jsxs("div",{className:`${P[M]} text-center ${w.transitionNormal}`,children:[i&&e.jsx("div",{className:"flex justify-center mb-2",children:e.jsx("div",{className:`w-8 h-8 ${B}`,children:i})}),e.jsx("div",{className:`text-xs uppercase tracking-wide font-medium ${w.subtext} mb-1`,children:b}),e.jsxs("div",{className:`${F} font-bold leading-tight ${B}`,children:[y,R!==void 0&&e.jsx("span",{className:`text-xs ml-1 ${V(R)}`,children:C(R)})]}),A&&e.jsx("div",{className:`text-xs ${w.subtext} mt-1`,children:A})]})}const te={primary:"#3b82f6",success:"#10b981",warning:"#f59e0b",danger:"#ef4444",purple:"#8b5cf6",indigo:"#6366f1",cyan:"#06b6d4",orange:"#f97316"};function Be({data:b,dataKey:y="rating",chartId:A="modern-area",color:R="success",title:I="Trend ultime 10 partite",showGrid:d=!0}){const M=te[R]||te.success,i=b.slice(-10),w=N.useMemo(()=>{if(i.length===0)return["auto","auto"];let P=1/0,v=-1/0;if(i.forEach(Y=>{const W=Y[y];typeof W=="number"&&(P=Math.min(P,W),v=Math.max(v,W))}),P===1/0)return["auto","auto"];const q=(v-P)*.08;return[Math.max(0,Math.floor(P-q)),Math.ceil(v+q)]},[i,y]),B=({active:P,payload:v,label:_})=>P&&v&&v.length?e.jsxs("div",{className:"bg-white/95 dark:bg-gray-800/95 backdrop-blur-sm border border-gray-200 dark:border-gray-700 rounded-xl shadow-xl p-4",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100 mb-2",children:_}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:e.jsxs("span",{className:"font-semibold",style:{color:M},children:[y,": ",v[0].value]})})]}):null,F=i.length>1?i[i.length-1][y]-i[0][y]:0,C=F>0?"#10b981":F<0?"#ef4444":"#6b7280",V=F>0?"↗":F<0?"↘":"→";return e.jsxs("div",{className:"h-64 sm:h-80",children:[e.jsx(pe,{width:"100%",height:"100%",children:e.jsxs(fe,{data:i,margin:{left:10,right:10,top:20,bottom:20},children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:`modernGradient-${A}`,x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:M,stopOpacity:.4}),e.jsx("stop",{offset:"50%",stopColor:M,stopOpacity:.2}),e.jsx("stop",{offset:"100%",stopColor:M,stopOpacity:.05})]}),e.jsxs("filter",{id:`glow-${A}`,children:[e.jsx("feGaussianBlur",{stdDeviation:"3",result:"coloredBlur"}),e.jsxs("feMerge",{children:[e.jsx("feMergeNode",{in:"coloredBlur"}),e.jsx("feMergeNode",{in:"SourceGraphic"})]})]})]}),d&&e.jsx(be,{strokeDasharray:"2 4",strokeOpacity:.15,horizontal:!0,vertical:!1}),e.jsx(je,{dataKey:"label",tick:{fontSize:11,fill:"#6b7280"},axisLine:!1,tickLine:!1,interval:"preserveStartEnd"}),e.jsx(ve,{tick:{fontSize:11,fill:"#6b7280"},axisLine:!1,tickLine:!1,width:50,domain:w,scale:"linear"}),e.jsx(Ne,{content:e.jsx(B,{})}),e.jsx(ye,{type:"monotone",dataKey:y,stroke:M,strokeWidth:3,fill:`url(#modernGradient-${A})`,dot:{r:3,fill:M,stroke:"white",strokeWidth:2,filter:`url(#glow-${A})`},activeDot:{r:6,fill:M,stroke:"white",strokeWidth:3,className:"drop-shadow-lg animate-pulse"},className:"drop-shadow-sm"})]})}),e.jsxs("div",{className:"flex justify-between items-center mt-3 px-2",children:[e.jsx("span",{className:"text-xs font-medium text-gray-600 dark:text-gray-400",children:I}),e.jsxs("div",{className:"flex items-center gap-2",children:[i.length>1&&e.jsx("div",{className:"flex items-center gap-1",children:e.jsxs("span",{className:"text-sm font-bold",style:{color:C},children:[V," ",Math.abs(F).toFixed(0)]})}),e.jsxs("span",{className:"text-xs text-gray-500",children:[i.length," partite"]})]})]})]})}function Se({players:b,matches:y,selectedPlayerId:A,onSelectPlayer:R,onShowFormula:I,T:d}){var Q;const M=N.useRef(null),[i,w]=N.useState(A||((Q=b[0])==null?void 0:Q.id)||""),[B,F]=N.useState(""),[C,V]=N.useState("all"),[P,v]=N.useState(null),[_,q]=N.useState(!1),[Y,W]=N.useState(null);N.useEffect(()=>{A&&w(A)},[A]);const E=t=>{var s;return((s=b.find(c=>c.id===t))==null?void 0:s.name)||t},m=b.find(t=>t.id===i)||null;b.find(t=>t.id===B);const O=N.useMemo(()=>{if(C==="all")return y;const t=new Date,s=new Date;switch(C){case"1w":s.setDate(t.getDate()-7);break;case"2w":s.setDate(t.getDate()-14);break;case"30d":s.setDate(t.getDate()-30);break;case"3m":s.setMonth(t.getMonth()-3);break;case"6m":s.setMonth(t.getMonth()-6);break;default:return y}return(y||[]).filter(c=>new Date(c.date)>=s)},[y,C]),se=N.useMemo(()=>[...b].sort((t,s)=>s.rating-t.rating),[b]),ae=m?se.findIndex(t=>t.id===m.id)+1:null,Z=((m==null?void 0:m.wins)||0)+((m==null?void 0:m.losses)||0);Z&&Math.round(m.wins/Z*100);const a=N.useMemo(()=>{if(!i)return null;const t=(O||[]).filter(g=>(g.teamA||[]).includes(i)||(g.teamB||[]).includes(i));if(t.length===0)return null;let s=0,c=0,l=0,p=0,h=0,u=0,k=0,j=0,f=0,$=0,n=0;const o=[...t].sort((g,D)=>new Date(g.date)-new Date(D.date));o.forEach(g=>{const D=(g.teamA||[]).includes(i),U=D&&g.winner==="A"||!D&&g.winner==="B",H=D?g.deltaA||0:g.deltaB||0;k+=H,U?(h++,l++,p=0,s=Math.max(s,l),(D&&g.setsA===2&&g.setsB===0||!D&&g.setsB===2&&g.setsA===0)&&n++):(u++,p++,l=0,c=Math.max(c,p)),(g.setsA===2&&g.setsB===1||g.setsA===1&&g.setsB===2)&&$++,D?(j+=g.gamesA||0,f+=g.gamesB||0):(j+=g.gamesB||0,f+=g.gamesA||0)});let r=0,x=null;for(let g=o.length-1;g>=0;g--){const D=o[g],U=(D.teamA||[]).includes(i),H=U&&D.winner==="A"||!U&&D.winner==="B";if(x===null)x=H,r=1;else if(x===H)r++;else break}const G=k/t.length,S=j+f>0?j/(j+f)*100:0,de=h>0?n/h*100:0,ce=$>0?(h-n)/$*100:0;return{wins:h,losses:u,winRate:h+u>0?h/(h+u)*100:0,currentStreak:x===null?0:x?r:-r,maxWinStreak:s,maxLoseStreak:c,avgDelta:Math.round(G*10)/10,gameEfficiency:Math.round(S*10)/10,dominanceRate:Math.round(de*10)/10,clutchRate:Math.round(ce*10)/10,totalMatches:t.length,closeMatches:$,dominantWins:n}},[i,O]),L=({label:t,value:s,sub:c,trend:l,color:p="default"})=>e.jsx($e,{label:t,value:s,subtitle:c,trend:l,color:p,size:"lg",T:d}),J=N.useMemo(()=>[...b].sort(ke),[b]),re=N.useMemo(()=>{if(!i)return[];const t=new Map(b.map(l=>[l.id,Number(l.baseRating??l.startRating??l.rating??X)])),s=[];s.push({date:null,label:"Start",rating:Math.round(t.get(i)??X)});const c=[...O||[]].sort((l,p)=>new Date(l.date)-new Date(p.date));for(const l of c){oe(l.sets);const p=(k,j)=>t.set(k,(t.get(k)??X)+j),h=l.deltaA??0,u=l.deltaB??0;p(l.teamA[0],h),p(l.teamA[1],h),p(l.teamB[0],u),p(l.teamB[1],u),(l.teamA.includes(i)||l.teamB.includes(i))&&s.push({date:new Date(l.date),label:new Date(l.date).toLocaleString("it-IT",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"}),rating:Math.round(t.get(i)??X)})}return s},[i,b,O]),z=N.useMemo(()=>{if(!i)return{mates:[],opps:[],topMates:[],worstMates:[],topOpps:[],worstOpps:[]};const t=(O||[]).filter(n=>(n.teamA||[]).includes(i)||(n.teamB||[]).includes(i)),s=new Map,c=new Map,l=(n,o,r)=>{if(!o)return;const x=n.get(o)||{wins:0,losses:0};r?x.wins++:x.losses++,n.set(o,x)};for(const n of t){const o=(n.teamA||[]).includes(i),r=o&&n.winner==="A"||!o&&n.winner==="B",x=o?(n.teamA||[]).find(S=>S!==i):(n.teamB||[]).find(S=>S!==i),G=o?n.teamB||[]:n.teamA||[];x&&l(s,x,r);for(const S of G)l(c,S,r)}const p=n=>[...n.entries()].map(([o,r])=>{const x=r.wins+r.losses,G=x?Math.round(r.wins/x*100):0;return{id:o,name:E(o),wins:r.wins,losses:r.losses,total:x,winPct:G}}).sort((o,r)=>r.total-o.total||r.winPct-o.winPct||Ae.compare(o.name,r.name)),h=p(s),u=p(c),k=h.sort((n,o)=>o.winPct-n.winPct).slice(0,5),j=h.sort((n,o)=>n.winPct-o.winPct).slice(0,5),f=u.sort((n,o)=>o.winPct-n.winPct).slice(0,5),$=u.sort((n,o)=>n.winPct-o.winPct).slice(0,5);return{mates:h,opps:u,topMates:k,worstMates:j,topOpps:f,worstOpps:$}},[i,O,b]),ie=()=>[`Statistiche — ${m?m.name:""}`,`Ranking: ${m?Math.round(m.rating):"-"}`,`Record: ${(a==null?void 0:a.wins)||0}–${(a==null?void 0:a.losses)||0} (${Math.round((a==null?void 0:a.winRate)||0)}%)`,`Game Eff.: ${a?a.gameEfficiency:0}% • Δ medio: ${a?a.avgDelta:0}`,"#PlaySportPro #Tennis #Padel"].join(`
`),ne=typeof window<"u"?`${window.location.origin}${window.location.pathname}#stats-${i||""}`:"",le=()=>{var k,j;const t=Y;if(!t)return null;const s=(t.teamA||[]).includes(i),c=s&&t.winner==="A"||!s&&t.winner==="B",l=s?t.deltaA??0:t.deltaB??0;(s?t.teamA:t.teamB).map(f=>E(f)),(s?t.teamB:t.teamA).map(f=>E(f));const p=Math.round(t.sumA||0),h=Math.round(t.sumB||0),u=Math.round(t.gap||0);return t.factor,t.base,t.gd,e.jsx(we,{open:_,onClose:()=>{q(!1),W(null)},title:"Sistema RPA - Ranking Points Algorithm",size:"lg",T:d,children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg border border-blue-200 dark:border-blue-700",children:[e.jsx("h4",{className:"font-semibold text-blue-900 dark:text-blue-100 mb-2",children:"🎯 Cos'è il Sistema RPA?"}),e.jsxs("p",{className:"text-blue-800 dark:text-blue-200 text-sm leading-relaxed mb-3",children:["Il ",e.jsx("strong",{children:"Ranking Points Algorithm (RPA)"})," è un sistema di punteggio dinamico che assegna punti in base alla differenza di livello tra le squadre e al risultato della partita. Più forte è l'avversario sconfitto, più punti si guadagnano!"]}),e.jsxs("div",{className:"bg-white dark:bg-blue-800/30 p-3 rounded border",children:[e.jsx("div",{className:"text-center text-lg font-bold text-blue-600 dark:text-blue-300 mb-2",children:"Punti = (Base + DG) × Factor"}),e.jsxs("div",{className:"text-xs text-blue-700 dark:text-blue-200 space-y-1",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Base"})," = (Ranking TeamA + Ranking TeamB) ÷ 100"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"DG"})," = Differenza Game tra vincitori e perdenti"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Factor"})," = Moltiplicatore basato sul Gap di ranking"]})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-gray-100 mb-3",children:"⚖️ Scaglioni Factor"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-xs",children:[e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 p-2 rounded border text-center",children:[e.jsx("div",{className:"font-mono text-red-600 font-bold",children:"≤-1500"}),e.jsx("div",{className:"text-red-600 font-semibold",children:"0.6-0.75"}),e.jsx("div",{className:"text-[10px] text-red-700",children:"Molto più debole"})]}),e.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 p-2 rounded border text-center",children:[e.jsx("div",{className:"font-mono text-yellow-700 font-bold",children:"-300~+300"}),e.jsx("div",{className:"text-yellow-700 font-semibold",children:"0.9-1.1"}),e.jsx("div",{className:"text-[10px] text-yellow-800",children:"Equilibrato"})]}),e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 p-2 rounded border text-center",children:[e.jsx("div",{className:"font-mono text-green-600 font-bold",children:"≥+1500"}),e.jsx("div",{className:"text-green-600 font-semibold",children:"1.25-1.6"}),e.jsx("div",{className:"text-[10px] text-green-700",children:"Molto più forte"})]})]})]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg border border-blue-200 dark:border-blue-700",children:[e.jsx("h4",{className:"font-semibold text-blue-900 dark:text-blue-100 mb-3",children:"� Partita Analizzata"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:`p-3 rounded-lg ${c&&s||!c&&!s?"bg-green-100 dark:bg-green-900/30 border-2 border-green-300":"bg-gray-100 dark:bg-gray-700 border-2 border-gray-300"}`,children:[e.jsx("div",{className:"font-semibold text-gray-900 dark:text-gray-100",children:"Team A"}),e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-300 mb-1",children:(k=t.teamA)==null?void 0:k.map(f=>E(f)).join(" & ")}),e.jsxs("div",{className:"text-lg font-bold text-blue-600",children:["Rating: ",p]}),e.jsxs("div",{className:"text-xs",children:["Sets: ",t.setsA," • Games: ",t.gamesA]})]}),e.jsxs("div",{className:`p-3 rounded-lg ${c&&!s||!c&&s?"bg-green-100 dark:bg-green-900/30 border-2 border-green-300":"bg-gray-100 dark:bg-gray-700 border-2 border-gray-300"}`,children:[e.jsx("div",{className:"font-semibold text-gray-900 dark:text-gray-100",children:"Team B"}),e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-300 mb-1",children:(j=t.teamB)==null?void 0:j.map(f=>E(f)).join(" & ")}),e.jsxs("div",{className:"text-lg font-bold text-blue-600",children:["Rating: ",h]}),e.jsxs("div",{className:"text-xs",children:["Sets: ",t.setsB," • Games: ",t.gamesB]})]})]}),t.date&&e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2 text-center",children:["📅 ",new Date(t.date).toLocaleDateString("it-IT",{weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})]})]}),e.jsxs("div",{className:"bg-gradient-to-r from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20 p-4 rounded-lg border-2 border-purple-200 dark:border-purple-700",children:[e.jsxs("h4",{className:"font-semibold text-purple-900 dark:text-purple-100 mb-2 flex items-center gap-2",children:["🎯 Risultato per ",E(i)]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm text-purple-700 dark:text-purple-300 mb-1",children:c?"🏆 Vittoria!":"💔 Sconfitta"}),e.jsxs("div",{className:`text-3xl font-bold ${l>=0?"text-green-600":"text-red-600"} mb-2`,children:[l>=0?"+":"",Math.round(l)," punti"]}),e.jsx("div",{className:"text-xs text-purple-600 dark:text-purple-400 bg-white dark:bg-purple-900/20 p-2 rounded",children:c?u>300?"🚀 Ottima vittoria contro avversari più forti!":u<-300?"⚠️ Vittoria facile, pochi punti guadagnati":"✅ Vittoria equilibrata, punti standard":u>300?"😓 Sconfitta comprensibile contro avversari forti":u<-300?"😱 Brutta sconfitta, molti punti persi!":"📉 Sconfitta equilibrata, punti standard persi"})]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 p-3 rounded-lg border text-xs",children:[e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-gray-100 mb-2 text-sm",children:"💡 Punti Chiave"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{children:["• ",e.jsx("strong",{children:"Battere i forti"}),": Factor ",">"," 1.0 = Più punti"]}),e.jsxs("div",{children:["• ",e.jsx("strong",{children:"Vittorie nette"}),": DG alta = Bonus punti"]}),e.jsxs("div",{children:["• ",e.jsx("strong",{children:"Avversari deboli"}),": Factor ","<"," 1.0 = Meno punti"]}),e.jsxs("div",{children:["• ",e.jsx("strong",{children:"Perdere"}),": Stessi punti ma negativi"]})]})]})]})})};return e.jsxs(he,{title:"Statistiche giocatore",right:e.jsx(ue,{size:"sm",title:`Statistiche — ${m?m.name:""}`,url:ne,captureRef:M,captionBuilder:ie,T:d}),T:d,children:[e.jsxs("div",{ref:M,children:[e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:`text-xs font-medium ${d.subtext} mb-1`,children:"Giocatore"}),e.jsx("select",{value:i,onChange:t=>{w(t.target.value),R==null||R(t.target.value)},className:`${d.input} w-full text-sm`,children:J.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))})]}),e.jsxs("div",{children:[e.jsx("div",{className:`text-xs font-medium ${d.subtext} mb-1`,children:"Periodo"}),e.jsxs("select",{value:C,onChange:t=>V(t.target.value),className:`${d.input} w-full text-sm`,children:[e.jsx("option",{value:"1w",children:"1 settimana"}),e.jsx("option",{value:"2w",children:"2 settimane"}),e.jsx("option",{value:"30d",children:"30 giorni"}),e.jsx("option",{value:"3m",children:"3 mesi"}),e.jsx("option",{value:"6m",children:"6 mesi"}),e.jsx("option",{value:"all",children:"Tutto"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 sm:gap-3",children:[e.jsx(L,{label:"Posizione",value:ae??"-"}),e.jsx(L,{label:"Ranking",value:m?Math.round(m.rating):"-",color:"primary"}),e.jsx(L,{label:"Win Rate",value:`${a?Math.round(a.winRate):0}%`,sub:`${(a==null?void 0:a.wins)||0}–${(a==null?void 0:a.losses)||0}`})]})]}),a&&e.jsxs("div",{className:"grid grid-cols-2 gap-2 sm:gap-3 mb-6",children:[e.jsx(L,{label:"Efficienza game",value:`${a.gameEfficiency}%`,sub:"% game vinti",color:"primary"}),e.jsx(L,{label:"Δ medio",value:a.avgDelta>0?`+${a.avgDelta}`:`${a.avgDelta}`,sub:"punti per partita",color:a.avgDelta>=0?"success":"danger"}),e.jsx(L,{label:"Streak migliori",value:`${a.maxWinStreak}`,sub:"vittorie consecutive",color:"success"}),e.jsx(L,{label:"Streak attive",value:a.currentStreak>0?`+${a.currentStreak}`:`${a.currentStreak}`,sub:a.currentStreak===0?"equilibrio":a.currentStreak>0?"vittorie":"sconfitte",color:a.currentStreak>0?"success":a.currentStreak<0?"danger":"default"})]}),e.jsxs("div",{className:`rounded-2xl ${d.cardBg} ${d.border} p-4 mb-6`,children:[e.jsxs("div",{className:"font-medium mb-3 flex items-center justify-between",children:[e.jsx("span",{children:"Andamento ranking"}),e.jsx("span",{className:"text-xs text-gray-500",children:C==="all"?"Tutte le partite":"Periodo attivo"})]}),e.jsx(Be,{data:re,dataKey:"rating",chartId:`player-${i}`,color:"success",title:"Evoluzione del rating"})]}),e.jsxs("div",{className:`rounded-2xl ${d.cardBg} ${d.border} p-3 sm:p-4 mb-6`,children:[e.jsxs("div",{className:"space-y-3 mb-4",children:[e.jsx("div",{className:"font-medium",children:"Confronto diretto"}),e.jsxs("select",{value:B,onChange:t=>F(t.target.value),className:`${d.input} w-full text-sm`,children:[e.jsx("option",{value:"",children:"Seleziona un giocatore…"}),J.filter(t=>t.id!==i).map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),B?(()=>{const t=b.find(r=>r.id===B),s=(O||[]).filter(r=>(r.teamA||[]).includes(t.id)||(r.teamB||[]).includes(t.id));let c=0,l=0,p=0,h=0,u=0;const k=[...s].sort((r,x)=>new Date(r.date)-new Date(x.date));k.forEach(r=>{const x=(r.teamA||[]).includes(t.id),G=x&&r.winner==="A"||!x&&r.winner==="B",S=x?r.deltaA||0:r.deltaB||0;G?c++:l++,x?(h+=r.gamesA||0,u+=r.gamesB||0):(h+=r.gamesB||0,u+=r.gamesA||0),p+=S});let j=null;for(let r=k.length-1;r>=0;r--){const x=k[r],G=(x.teamA||[]).includes(t.id),S=G&&x.winner==="A"||!G&&x.winner==="B";if(j===null)j=S;else if(j!==S)break}const f=c+l>0?Math.round(c/(c+l)*100):0,$=h+u>0?Math.round(h/(h+u)*1e3)/10:0,n=c+l>0?Math.round(p/(c+l)*10)/10:0,o=[{metric:"Ranking",player1:m?Math.round(m.rating):"-",player2:t?Math.round(t.rating):"-",diff:m&&t?Math.round(m.rating-t.rating):"-"},{metric:"Win Rate",player1:`${a?Math.round(a.winRate):0}%`,player2:`${f}%`,diff:`${a?Math.round(a.winRate-f):0}%`},{metric:"Partite",player1:a?a.totalMatches:0,player2:c+l,diff:a?a.totalMatches-(c+l):0},{metric:"Eff. game",player1:`${a?a.gameEfficiency:0}%`,player2:`${$}%`,diff:`${a?Math.round((a.gameEfficiency-$)*10)/10:0}%`},{metric:"Δ medio",player1:a?a.avgDelta:0,player2:n,diff:a?Math.round((a.avgDelta-n)*10)/10:0}];return e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"space-y-3 sm:hidden",children:o.map((r,x)=>e.jsxs("div",{className:`rounded-lg p-3 ${d.cardBg} border ${d.border}`,children:[e.jsx("div",{className:"font-medium text-sm mb-2",children:r.metric}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-center text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:r.player1}),e.jsx("div",{className:"text-xs text-gray-500 truncate",children:m==null?void 0:m.name})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:r.player2}),e.jsx("div",{className:"text-xs text-gray-500 truncate",children:t==null?void 0:t.name})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-blue-600",children:r.diff}),e.jsx("div",{className:"text-xs text-gray-500",children:"Diff"})]})]})]},x))}),e.jsx("div",{className:"hidden sm:block overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:`border-b ${d.border} ${d.tableHeadText}`,children:[e.jsx("th",{className:"text-left py-2",children:"Metrica"}),e.jsx("th",{className:"text-center py-2",children:(m==null?void 0:m.name)||"-"}),e.jsx("th",{className:"text-center py-2",children:(t==null?void 0:t.name)||"-"}),e.jsx("th",{className:"text-center py-2",children:"Diff"})]})}),e.jsx("tbody",{children:o.map((r,x)=>e.jsxs("tr",{className:"border-b border-black/5",children:[e.jsx("td",{className:"py-2 font-medium",children:r.metric}),e.jsx("td",{className:"text-center py-2",children:r.player1}),e.jsx("td",{className:"text-center py-2",children:r.player2}),e.jsx("td",{className:"text-center py-2",children:r.diff})]},x))})]})})]})})():e.jsx("div",{className:`text-sm ${d.subtext}`,children:"Seleziona un giocatore per confrontare le statistiche"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h3",{className:"font-medium text-base flex items-center gap-2",children:[e.jsx("span",{className:"text-emerald-600",children:"🏆"}),"Top 5 Compagni"]}),z.topMates.length>0?e.jsx("div",{className:`rounded-xl ${d.cardBg} ${d.border} p-3 sm:p-4`,children:e.jsx("div",{className:"space-y-3",children:z.topMates.map((t,s)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 min-w-0 flex-1",children:[e.jsx("div",{className:`w-5 h-5 sm:w-6 sm:h-6 rounded-full flex items-center justify-center text-xs font-bold ${s===0?"bg-yellow-100 text-yellow-600":s===1?"bg-gray-100 text-gray-600":s===2?"bg-orange-100 text-orange-600":"bg-gray-50 text-gray-500"}`,children:s+1}),e.jsx("span",{className:"font-medium text-sm truncate",children:t.name})]}),e.jsxs("div",{className:"text-right shrink-0",children:[e.jsxs("div",{className:"font-bold text-emerald-600 text-sm",children:[Math.round(t.winPct),"%"]}),e.jsxs("div",{className:"text-xs text-gray-500",children:[t.wins,"V-",t.losses,"S"]})]})]},t.id))})}):e.jsx("div",{className:`text-sm ${d.subtext} text-center py-6`,children:"Nessun compagno disponibile"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h3",{className:"font-medium text-base flex items-center gap-2",children:[e.jsx("span",{className:"text-rose-600",children:"😞"}),"Worst 5 Compagni"]}),z.worstMates.length>0?e.jsx("div",{className:`rounded-xl ${d.cardBg} ${d.border} p-3 sm:p-4`,children:e.jsx("div",{className:"space-y-3",children:z.worstMates.map((t,s)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 min-w-0 flex-1",children:[e.jsx("div",{className:`w-5 h-5 sm:w-6 sm:h-6 rounded-full flex items-center justify-center text-xs font-bold ${s===0?"bg-red-100 text-red-600":s===1?"bg-orange-100 text-orange-600":s===2?"bg-yellow-100 text-yellow-600":"bg-gray-50 text-gray-500"}`,children:s+1}),e.jsx("span",{className:"font-medium text-sm truncate",children:t.name})]}),e.jsxs("div",{className:"text-right shrink-0",children:[e.jsxs("div",{className:"font-bold text-rose-600 text-sm",children:[Math.round(t.winPct),"%"]}),e.jsxs("div",{className:"text-xs text-gray-500",children:[t.wins,"V-",t.losses,"S"]})]})]},t.id))})}):e.jsx("div",{className:`text-sm ${d.subtext} text-center py-6`,children:"Nessun compagno disponibile"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h3",{className:"font-medium text-base flex items-center gap-2",children:[e.jsx("span",{className:"text-emerald-600",children:"🎯"}),"Top 5 Avversari Preferiti"]}),z.topOpps.length>0?e.jsx("div",{className:`rounded-xl ${d.cardBg} ${d.border} p-3 sm:p-4`,children:e.jsx("div",{className:"space-y-3",children:z.topOpps.map((t,s)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 min-w-0 flex-1",children:[e.jsx("div",{className:`w-5 h-5 sm:w-6 sm:h-6 rounded-full flex items-center justify-center text-xs font-bold ${s===0?"bg-yellow-100 text-yellow-600":s===1?"bg-gray-100 text-gray-600":s===2?"bg-orange-100 text-orange-600":"bg-gray-50 text-gray-500"}`,children:s+1}),e.jsx("span",{className:"font-medium text-sm truncate",children:t.name})]}),e.jsxs("div",{className:"text-right shrink-0",children:[e.jsxs("div",{className:"font-bold text-emerald-600 text-sm",children:[Math.round(t.winPct),"%"]}),e.jsxs("div",{className:"text-xs text-gray-500",children:[t.wins,"V-",t.losses,"S"]})]})]},t.id))})}):e.jsx("div",{className:`text-sm ${d.subtext} text-center py-6`,children:"Nessun avversario disponibile"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h3",{className:"font-medium text-base flex items-center gap-2",children:[e.jsx("span",{className:"text-rose-600",children:"💀"}),"Top 5 Bestie Nere"]}),z.worstOpps.length>0?e.jsx("div",{className:`rounded-xl ${d.cardBg} ${d.border} p-3 sm:p-4`,children:e.jsx("div",{className:"space-y-3",children:z.worstOpps.map((t,s)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 min-w-0 flex-1",children:[e.jsx("div",{className:`w-5 h-5 sm:w-6 sm:h-6 rounded-full flex items-center justify-center text-xs font-bold ${s===0?"bg-red-100 text-red-600":s===1?"bg-orange-100 text-orange-600":s===2?"bg-yellow-100 text-yellow-600":"bg-gray-50 text-gray-500"}`,children:s+1}),e.jsx("span",{className:"font-medium text-sm truncate",children:t.name})]}),e.jsxs("div",{className:"text-right shrink-0",children:[e.jsxs("div",{className:"font-bold text-rose-600 text-sm",children:[Math.round(t.winPct),"%"]}),e.jsxs("div",{className:"text-xs text-gray-500",children:[t.wins,"V-",t.losses,"S"]})]})]},t.id))})}):e.jsx("div",{className:`text-sm ${d.subtext} text-center py-6`,children:"Nessun avversario disponibile"})]})]}),e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"font-medium text-sm sm:text-base",children:["Storico partite ",C!=="all"?"(periodo filtrato)":""]}),e.jsxs("div",{className:"text-xs text-gray-500",children:[(O||[]).filter(t=>(t.teamA||[]).includes(i)||(t.teamB||[]).includes(i)).length," ","partite"]})]}),e.jsx("div",{className:"space-y-2 sm:space-y-3",children:(O||[]).filter(t=>(t.teamA||[]).includes(i)||(t.teamB||[]).includes(i)).slice().sort((t,s)=>new Date(s.date)-new Date(t.date)).map(t=>{const s=(t.teamA||[]).includes(i),c=s?t.deltaA??0:t.deltaB??0,l=s&&t.winner==="A"||!s&&t.winner==="B",p=(s?t.teamA:t.teamB).map(n=>T(E(n))).join(" & "),h=(s?t.teamB:t.teamA).map(n=>T(E(n))).join(" & "),u=(s?t.teamA:t.teamB).map(n=>E(n)).join(" & "),k=(s?t.teamB:t.teamA).map(n=>E(n)).join(" & "),j=l?"text-emerald-600 font-semibold":"text-rose-600 font-semibold",f=l?"text-rose-600 font-semibold":"text-emerald-600 font-semibold",$=P===t.id;return e.jsxs("div",{className:`rounded-xl ${d.cardBg} ${d.border} overflow-hidden transition-all ${$?"ring-2 ring-blue-500/40":""}`,children:[e.jsxs("div",{className:"p-3 flex items-center justify-between gap-2 cursor-pointer hover:bg-black/5 transition-colors",role:"button",tabIndex:0,onClick:()=>v($?null:t.id),onKeyDown:n=>{(n.key==="Enter"||n.key===" ")&&(n.preventDefault(),v(o=>o===t.id?null:t.id))},"aria-expanded":$,children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-1 sm:gap-2 mb-1",children:[e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium w-fit ${l?"bg-emerald-100 text-emerald-800":"bg-rose-100 text-rose-800"}`,children:l?"✓ Vittoria":"✗ Sconfitta"}),t.date&&e.jsx("span",{className:"text-xs text-gray-500",children:new Date(t.date).toLocaleDateString("it-IT",{day:"2-digit",month:"short"})})]}),e.jsx("div",{className:"text-xs sm:text-sm mb-1",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-1 sm:gap-2",children:[e.jsx("span",{className:`${j} font-medium`,children:p}),e.jsx("span",{className:"text-gray-500 hidden sm:inline",children:"vs"}),e.jsx("span",{className:`${f} font-medium`,children:h})]})}),e.jsxs("div",{className:"text-xs text-gray-600",children:["Sets ",s?t.setsA:t.setsB,"-",s?t.setsB:t.setsA," • Games"," ",s?t.gamesA:t.gamesB,"-",s?t.gamesB:t.gamesA]})]}),e.jsxs("div",{className:"shrink-0 text-right flex items-center gap-1 sm:gap-2",children:[e.jsxs("div",{children:[e.jsxs("div",{className:`text-sm sm:text-lg font-bold ${c>=0?"text-emerald-600":"text-rose-600"}`,children:[c>=0?"+":"",Math.round(c)]}),e.jsx("div",{className:"text-[9px] sm:text-[10px] text-gray-500 dark:text-gray-400",children:"punti"})]}),e.jsx("button",{onClick:n=>{n.stopPropagation(),W(t),q(!0)},className:"w-4 h-4 sm:w-5 sm:h-5 rounded-full bg-blue-500 text-white text-xs flex items-center justify-center hover:bg-blue-600 transition-colors",title:"Spiegazione formula RPA",children:"?"}),e.jsx("div",{className:"text-gray-400 dark:text-gray-300 text-xs sm:text-sm",children:$?"▲":"▼"})]})]}),$&&e.jsx("div",{className:"border-t border-gray-200 dark:border-gray-500 bg-gray-50 dark:bg-gray-700",children:e.jsxs("div",{className:"p-3 sm:p-4 space-y-3 sm:space-y-4",children:[e.jsxs("div",{className:"space-y-2 sm:space-y-0 sm:grid sm:grid-cols-2 sm:gap-3 text-sm",children:[e.jsxs("div",{className:`p-3 rounded-lg border-2 ${l?"border-emerald-300 bg-emerald-50 dark:border-emerald-500 dark:bg-emerald-900/40":"border-gray-300 bg-white dark:border-gray-500 dark:bg-gray-600"}`,children:[e.jsx("div",{className:"font-semibold text-gray-900 dark:text-white mb-1 text-sm",children:u}),e.jsxs("div",{className:"text-xs text-gray-700 dark:text-gray-200",children:["Sets: ",s?t.setsA:t.setsB," • Games: ",s?t.gamesA:t.gamesB]})]}),e.jsxs("div",{className:`p-3 rounded-lg border-2 ${l?"border-gray-300 bg-white dark:border-gray-500 dark:bg-gray-600":"border-emerald-300 bg-emerald-50 dark:border-emerald-500 dark:bg-emerald-900/40"}`,children:[e.jsx("div",{className:"font-semibold text-gray-900 dark:text-white mb-1 text-sm",children:k}),e.jsxs("div",{className:"text-xs text-gray-700 dark:text-gray-200",children:["Sets: ",s?t.setsB:t.setsA," • Games: ",s?t.gamesB:t.gamesA]})]})]}),Array.isArray(t.sets)&&t.sets.length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-gray-700 dark:text-gray-200 mb-2",children:"Set per set:"}),e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-1",children:t.sets.map((n,o)=>e.jsxs("span",{className:"px-3 py-2 bg-white dark:bg-gray-600 rounded-lg text-sm border-2 border-gray-200 dark:border-gray-400 text-gray-900 dark:text-white font-medium shrink-0",children:[n.a,"-",n.b]},`${t.id}-set-${o}`))})]}),e.jsxs("div",{className:"border-t border-gray-300 dark:border-gray-500 pt-3",children:[e.jsx("div",{className:"text-sm font-semibold text-gray-700 dark:text-gray-200 mb-2",children:"Calcolo punti RPA:"}),e.jsxs("div",{className:"text-xs sm:text-sm space-y-2 text-gray-800 dark:text-gray-100",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-600 p-2 rounded border dark:border-gray-500",children:[e.jsx("strong",{children:"Rating:"})," A=",Math.round(t.sumA||0)," vs B=",Math.round(t.sumB||0)," (Gap: ",Math.round(t.gap||0),")"]}),e.jsxs("div",{className:"bg-white dark:bg-gray-600 p-2 rounded border dark:border-gray-500",children:[e.jsx("strong",{children:"Calcolo:"})," Base: ",(t.base||0).toFixed(1)," • DG:"," ",t.gd||0," • Factor: ",(t.factor||1).toFixed(2)]}),e.jsxs("div",{className:"bg-white dark:bg-gray-600 p-2 rounded border dark:border-gray-500",children:[e.jsx("strong",{children:"Risultato:"})," ",e.jsxs("span",{className:`font-bold text-base sm:text-lg ${c>=0?"text-emerald-600 dark:text-emerald-300":"text-rose-600 dark:text-rose-300"}`,children:[c>=0?"+":"",Math.round(c)," punti"]})]})]})]})]})})]},t.id)})})]})]}),e.jsx(le,{})]})}function Le(){const[b,y]=Me(),{derived:A}=xe(),R=ge.useMemo(()=>me(),[]),[I,d]=N.useState(b.get("player")||""),[M,i]=N.useState(""),w=B=>{d(B),y(B?{player:B}:{})};return e.jsxs(e.Fragment,{children:[e.jsx(Se,{T:R,players:A.players,matches:A.matches,selectedPlayerId:I,onSelectPlayer:w,onShowFormula:i}),M&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[80vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Formula calcolo punti (RPA) – Spiegazione"}),e.jsx("button",{onClick:()=>i(""),className:"text-gray-400 hover:text-gray-600",children:"×"})]}),e.jsx("pre",{className:"whitespace-pre-wrap text-sm",children:M})]})})})]})}export{Le as default};
