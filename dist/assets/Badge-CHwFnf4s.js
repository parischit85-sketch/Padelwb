const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/cloud-bookings-DZXqcMc1.js","assets/firebase-oRQd-T1V.js","assets/index-N3-yNM-x.js","assets/vendor-CDaM45aE.js","assets/router-ClepU2oc.js","assets/index-CQfFV5PZ.css"])))=>i.map(i=>d[i]);
import{_ as w,j as m}from"./index-N3-yNM-x.js";import{loadPublicBookings as A,getPublicBookings as O,createCloudBooking as _}from"./cloud-bookings-DZXqcMc1.js";import"./vendor-CDaM45aE.js";const z={courts:[{id:"campo1",name:"Campo 1 - Centrale",type:"terra-rossa",price60:45,price90:65,features:["Terra rossa","Illuminazione LED","Riscaldamento"],hasLighting:!0,hasHeating:!0,isOutdoor:!1,premium:!0},{id:"campo2",name:"Campo 2",type:"terra-rossa",price60:40,price90:58,features:["Terra rossa","Illuminazione","Riscaldamento"],hasLighting:!0,hasHeating:!0,isOutdoor:!1,premium:!1},{id:"campo3",name:"Campo 3",type:"cemento",price60:35,price90:50,features:["Cemento","Illuminazione","Riscaldamento"],hasLighting:!0,hasHeating:!0,isOutdoor:!1,premium:!1},{id:"campo4",name:"Campo 4 - Scoperto",type:"terra-rossa",price60:30,price90:42,features:["Terra rossa","Solo diurno"],hasLighting:!1,hasHeating:!1,isOutdoor:!0,premium:!1},{id:"campo5",name:"Campo 5",type:"cemento",price60:32,price90:46,features:["Cemento","Illuminazione"],hasLighting:!0,hasHeating:!1,isOutdoor:!1,premium:!1},{id:"campo6",name:"Campo 6 - Padel",type:"padel",price60:25,price90:35,features:["Padel","Illuminazione","Riscaldamento"],hasLighting:!0,hasHeating:!0,isOutdoor:!1,premium:!1},{id:"campo7",name:"Campo 7 - Calcetto",type:"calcetto",price60:40,price90:55,features:["Calcetto","Illuminazione","Riscaldamento"],hasLighting:!0,hasHeating:!0,isOutdoor:!1,premium:!1}]};function F(e,t,a,r,l,i=null){const o=a,s=f(a,r);return!l.some(n=>{if(n.id===i||n.courtId!==e||n.date!==t||n.status==="cancelled")return!1;const c=f(n.time,n.duration);return o>=n.time&&o<c||s>n.time&&s<=c||o<=n.time&&s>=c})}function f(e,t){const[a,r]=e.split(":").map(Number),l=a*60+r+t,i=Math.floor(l/60),o=l%60;return`${i.toString().padStart(2,"0")}:${o.toString().padStart(2,"0")}`}function N(){return`booking-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}const x={CONFIRMED:"confirmed"},I="ml-field-bookings";let u=!1,C=null,p=!1;function b(e,t=null){u=e,C=t}async function v(){if(u&&C)try{return await A()}catch(e){return console.warn("Errore caricamento da cloud, fallback a localStorage:",e),d()}return d()}function d(){try{const e=localStorage.getItem(I);return e?JSON.parse(e):[]}catch{return[]}}function S(e){try{return localStorage.setItem(I,JSON.stringify(e)),!0}catch{return!1}}async function H(e,t){if(u&&t)try{return{...await _(e,t),_storage:"cloud"}}catch(r){return console.warn("Errore creazione nel cloud, fallback a localStorage:",r),{...g(e,t),_storage:"local"}}return{...g(e,t),_storage:"local"}}function g(e,t){const a={id:N(),courtId:e.courtId,courtName:e.courtName,date:e.date,time:e.time,duration:e.duration,lighting:e.lighting||!1,heating:e.heating||!1,price:e.price,bookedBy:(t==null?void 0:t.displayName)||(t==null?void 0:t.email)||"Anonimo",userEmail:t==null?void 0:t.email,userPhone:e.userPhone||"",players:e.players||[],notes:e.notes||"",status:x.CONFIRMED,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),createdBy:(t==null?void 0:t.uid)||null},r=d();return r.push(a),S(r),a}async function E(){if(u)try{return await O()}catch(e){return(e==null?void 0:e.code)==="failed-precondition"?p||(console.warn("Cloud bookings richiedono un indice: uso dati locali (fallback)."),p=!0):console.warn("Errore caricamento pubbliche da cloud, fallback a localStorage:",e),h()}return h()}function h(){return d().filter(t=>t.status===x.CONFIRMED).map(t=>({id:t.id,courtId:t.courtId,courtName:t.courtName,date:t.date,time:t.time,duration:t.duration,status:t.status}))}async function L(e){try{b(!!(e!=null&&e.uid),e);const t=await E();if(e&&e.uid)try{const{loadActiveUserBookings:a}=await w(async()=>{const{loadActiveUserBookings:l}=await import("./cloud-bookings-DZXqcMc1.js");return{loadActiveUserBookings:l}},__vite__mapDeps([0,1,2,3,4,5])),r=await a(e.uid)}catch(a){console.warn("initializeBookingSystem: Cloud user data failed:",a)}return await k(),!0}catch(t){return console.error("initializeBookingSystem: Failed:",t),!1}}async function k(){try{let e=[];try{e=[...await E()]}catch(t){console.warn("syncAllBookings: Failed to load public bookings:",t)}try{const t=await d(),a=new Map;e.forEach(r=>{const l=r.id||`${r.date}-${r.time}-${r.courtId}`;a.set(l,r)}),t.forEach(r=>{const l=r.id||`${r.date}-${r.time}-${r.courtId}`;a.has(l)||a.set(l,r)}),e=Array.from(a.values()),await S(e)}catch(t){console.warn("syncAllBookings: Failed to sync local storage:",t)}return e}catch(e){return console.error("syncAllBookings: Complete failure:",e),[]}}async function T(e,t=!1){if(!e)return[];try{t?await L(e):await k();let a=[];if(u&&e.uid)try{const{loadActiveUserBookings:i}=await w(async()=>{const{loadActiveUserBookings:s}=await import("./cloud-bookings-DZXqcMc1.js");return{loadActiveUserBookings:s}},__vite__mapDeps([0,1,2,3,4,5])),o=await i(e.uid);o&&o.length>0&&(a=o)}catch(i){console.warn("Cloud user bookings not available:",i)}try{const o=(await v()).filter(s=>s.userEmail===e.email||s.email===e.email||s.userId===e.uid);if(a.length>0&&o.length>0){const s=new Map;a.forEach(n=>{s.set(n.id||`${n.date}-${n.time}-${n.courtId}`,n)}),o.forEach(n=>{const c=n.id||`${n.date}-${n.time}-${n.courtId}`;s.has(c)||s.set(c,n)}),a=Array.from(s.values())}else o.length>0&&(a=o)}catch(i){console.warn("localStorage user bookings not available:",i)}const r=new Date,l=a.filter(i=>new Date(`${i.date}T${i.time}:00`)>r);return l.sort((i,o)=>{const s=new Date(`${i.date}T${i.time}:00`),n=new Date(`${o.date}T${o.time}:00`);return s-n}),l}catch(a){return console.error("Error loading user bookings:",a),[]}}const y={default:"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-300",success:"bg-emerald-100 text-emerald-800 dark:bg-emerald-900/20 dark:text-emerald-400",danger:"bg-rose-100 text-rose-800 dark:bg-rose-900/20 dark:text-rose-400",warning:"bg-amber-100 text-amber-800 dark:bg-amber-900/20 dark:text-amber-400",info:"bg-blue-100 text-blue-800 dark:bg-blue-900/20 dark:text-blue-400",primary:"bg-emerald-500 text-black font-medium"},B={xs:"px-1.5 py-0.5 text-xs",sm:"px-2 py-1 text-xs",md:"px-2.5 py-1 text-sm",lg:"px-3 py-1.5 text-sm"};function U({children:e,variant:t="default",size:a="sm",icon:r,removable:l=!1,onRemove:i,T:o}){const s=y[t]||y.default,n=B[a]||B.sm,c=(o==null?void 0:o.borderMd)||"rounded-md",$=(o==null?void 0:o.transitionFast)||"transition-all duration-200";return m.jsxs("span",{className:`
      inline-flex items-center gap-1 
      ${c} 
      ${s} 
      ${n}
      font-medium
      ${$}
    `,children:[r&&m.jsx("span",{className:"w-3 h-3",children:r}),e,l&&i&&m.jsx("button",{onClick:i,className:"ml-1 hover:bg-black/10 rounded-full w-3 h-3 flex items-center justify-center text-xs",children:"Ã—"})]})}export{z as B,U as a,E as b,H as c,T as g,F as i,b as s};
