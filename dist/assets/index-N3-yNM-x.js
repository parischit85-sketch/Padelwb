const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/LoginPage-DuNkjnPi.js","assets/vendor-CDaM45aE.js","assets/Section-D1bpE2En.js","assets/firebase-oRQd-T1V.js","assets/router-ClepU2oc.js","assets/DashboardPage-BOBpys0_.js","assets/Badge-CHwFnf4s.js","assets/cloud-bookings-DZXqcMc1.js","assets/Modal-DVTCsOa7.js","assets/ClassificaPage-hcFXV6sc.js","assets/charts-JFlVFhs5.js","assets/ShareButtons-_rrt24Wi.js","assets/StatsPage-PtMUzmiF.js","assets/names-DeuIsqgk.js","assets/BookingPage-D_OXFsHV.js","assets/pricing-C0IGBk9a.js","assets/PlayersPage-237ViPKA.js","assets/MatchesPage-KGbMqGXg.js","assets/notifications-RsqW2vlj.js","assets/TournamentsPage-CijueSuR.js","assets/ProfilePage-FNvKZIRc.js","assets/Extra-CnSwrdZ_.js","assets/format-DAEZv7Mi.js","assets/index-C_r86LdB.js","assets/ExtraPage-CNxXoFUx.js","assets/AdminBookingsPage-BA1FhRrJ.js"])))=>i.map(i=>d[i]);
import{r as b,a as Me,b as C}from"./vendor-CDaM45aE.js";import{g as ie,a as le,i as ce,b as de,c as ue,d as Re,s as Te,e as ze,G as Oe,f as me,h as We,F as $e,j as De,k as Fe,l as Ue,m as $,n as ge,u as Ve,o as fe,p as He,q as Ge,r as qe,t as Je}from"./firebase-oRQd-T1V.js";import{u as X,N as W,a as Ke,O as Ye,B as Xe,R as Ze,b as E}from"./router-ClepU2oc.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const d of a)if(d.type==="childList")for(const n of d.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&s(n)}).observe(document,{childList:!0,subtree:!0});function o(a){const d={};return a.integrity&&(d.integrity=a.integrity),a.referrerPolicy&&(d.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?d.credentials="include":a.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function s(a){if(a.ep)return;a.ep=!0;const d=o(a);fetch(a.href,d)}})();var he={exports:{}},V={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Qe=b,et=Symbol.for("react.element"),tt=Symbol.for("react.fragment"),rt=Object.prototype.hasOwnProperty,st=Qe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,at={key:!0,ref:!0,__self:!0,__source:!0};function pe(t,r,o){var s,a={},d=null,n=null;o!==void 0&&(d=""+o),r.key!==void 0&&(d=""+r.key),r.ref!==void 0&&(n=r.ref);for(s in r)rt.call(r,s)&&!at.hasOwnProperty(s)&&(a[s]=r[s]);if(t&&t.defaultProps)for(s in r=t.defaultProps,r)a[s]===void 0&&(a[s]=r[s]);return{$$typeof:et,type:t,key:d,ref:n,props:a,_owner:st.current}}V.Fragment=tt;V.jsx=pe;V.jsxs=pe;he.exports=V;var e=he.exports,xe,se=Me;xe=se.createRoot,se.hydrateRoot;const nt="modulepreload",ot=function(t){return"/"+t},ae={},B=function(r,o,s){let a=Promise.resolve();if(o&&o.length>0){document.getElementsByTagName("link");const n=document.querySelector("meta[property=csp-nonce]"),i=(n==null?void 0:n.nonce)||(n==null?void 0:n.getAttribute("nonce"));a=Promise.allSettled(o.map(u=>{if(u=ot(u),u in ae)return;ae[u]=!0;const m=u.endsWith(".css"),f=m?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${f}`))return;const g=document.createElement("link");if(g.rel=m?"stylesheet":nt,m||(g.as="script"),g.crossOrigin="",g.href=u,i&&g.setAttribute("nonce",i),document.head.appendChild(g),m)return new Promise((l,c)=>{g.addEventListener("load",l),g.addEventListener("error",()=>c(new Error(`Unable to preload CSS for ${u}`)))})}))}function d(n){const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=n,window.dispatchEvent(i),!i.defaultPrevented)throw n}return a.then(n=>{for(const i of n||[])i.status==="rejected"&&d(i.reason);return r().catch(d)})},O={apiKey:"AIzaSyDMP7772cyEY1oLzo8f9hMW7Leu4lWc6OU",authDomain:"m-padelweb.firebaseapp.com",projectId:"m-padelweb",appId:"1:1004722051733:web:3ce3c4476a9e329d80999c",storageBucket:"m-padelweb.firebasestorage.app",messagingSenderId:"1004722051733",measurementId:"G-0XZCHGMWVR"},it=["apiKey","authDomain","projectId","appId"],ne=it.filter(t=>!O[t]);if(ne.length>0)throw new Error(`Missing Firebase configuration: ${ne.join(", ")}`);const be=ie().length?le():ce(O),we=de(be),L=ue(be);L.useDeviceLanguage&&L.useDeviceLanguage();try{if(typeof window<"u"&&new URLSearchParams(window.location.search||"").has("authdebug")){const r={projectId:O.projectId,authDomain:O.authDomain,appId:O.appId,emulator:!1,isDev:!1,user:L!=null&&L.currentUser?{uid:L.currentUser.uid}:null};console.log("[Firebase][authdebug]",r)}}catch{}function ye(t){return He(L,r=>{try{t(r)}catch(o){console.error("onAuth callback error:",o),t(null)}},r=>{console.error("Firebase Auth error:",r),t(null)})}async function lt(){const t=new Oe;t.addScope("email"),t.addScope("profile"),t.setCustomParameters({prompt:"select_account"});let r=null;try{r=await me(L,t)}catch(o){const s=String((o==null?void 0:o.message)||"").toLowerCase(),a=String((o==null?void 0:o.code)||"").toLowerCase();if(s.includes("cross-origin-opener-policy")||s.includes("window.closed"))return r;if(a.includes("auth/unauthorized-domain")||a.includes("auth/operation-not-supported")||a.includes("auth/popup-blocked")||a.includes("auth/popup-closed-by-user")||s.includes("requests-from-referer")||s.includes("cross-origin")||s.includes("popup"))return await We(L,t),null;throw o}return r&&r.user&&await ve(r.user),r}async function ve(t){try{const r=await D(t.uid);if(!r.email||!r.firstName){const o=(t.displayName||"").split(" "),s={email:t.email,firstName:r.firstName||o[0]||"",lastName:r.lastName||o.slice(1).join(" ")||"",phone:r.phone||"",avatar:t.photoURL||"",provider:"google",...r};await H(t.uid,s)}}catch(r){console.warn("Errore creazione/aggiornamento profilo:",r)}}async function ct(){const t=new $e;t.addScope("email"),t.addScope("public_profile");const r=await me(L,t);return r&&r.user&&await ve(r.user),r}async function dt(t,r){if(!t||!r)throw new Error("Email e password sono obbligatorie");const o=await De(L,t,r);if(o.user){const s=await D(o.user.uid);s.email||await H(o.user.uid,{email:o.user.email,firstName:"",lastName:"",phone:"",provider:"password",...s})}return o}async function ut(t,r){if(!t||!r)throw new Error("Email e password sono obbligatorie");return Fe(L,t,r)}async function mt(t){if(!t)throw new Error("Email obbligatoria");return Ue(L,t)}async function gt(){try{const t=window.location.href;if(!Re(L,t))return null;let r=null;try{r=localStorage.getItem("ml-magic-email")}catch{}r||(r=window.prompt("Per completare l’accesso, inserisci la tua email:")||"");const o=await Te(L,r,t);try{localStorage.removeItem("ml-magic-email")}catch{}if(window.history.replaceState({},document.title,window.location.pathname),o.user){const s=await D(o.user.uid);if(!s.email){const a={email:o.user.email,firstName:"",lastName:"",phone:"",provider:"email",...s};await H(o.user.uid,a)}}return o}catch(t){throw console.warn("completeMagicLinkIfPresent error:",t),t}}async function ft(){await ze(L)}async function D(t){const r=$(we,"profiles",t),o=await fe(r);return o.exists()?o.data():{}}async function H(t,r){const o=$(we,"profiles",t);await ge(o,{...r,_updatedAt:Date.now()},{merge:!0})}async function ht(t,r){await Ve(t,{displayName:r})}const rr=Object.freeze(Object.defineProperty({__proto__:null,auth:L,completeMagicLinkIfPresent:gt,getUserProfile:D,loginWithEmailPassword:ut,loginWithFacebook:ct,loginWithGoogle:lt,logout:ft,onAuth:ye,registerWithEmailPassword:dt,saveUserProfile:H,sendResetPassword:mt,setDisplayName:ht},Symbol.toStringTag,{value:"Module"})),je=b.createContext(null),G=()=>{const t=b.useContext(je);if(!t)throw new Error("useAuth must be used within an AuthProvider");return t};function pt({children:t}){const[r,o]=b.useState(null),[s,a]=b.useState(null),[d,n]=b.useState(!0),[i,u]=b.useState(null);b.useEffect(()=>ye(async c=>{try{if(o(c),c){const p=await D(c.uid);a(p)}else a(null);u(null)}catch(p){console.error("Auth error:",p),u(p),a(null)}finally{n(!1)}}),[]);const m=!!r,f=(s==null?void 0:s.firstName)&&(s==null?void 0:s.phone),g={user:r,userProfile:s,setUserProfile:a,loading:d,error:i,isAuthenticated:m,isProfileComplete:f};return e.jsx(je.Provider,{value:g,children:t})}const xt={apiKey:"AIzaSyDMP7772cyEY1oLzo8f9hMW7Leu4lWc6OU",authDomain:"m-padelweb.firebaseapp.com",projectId:"m-padelweb"},ke=ie().length?le():ce(xt);ue(ke);const F=de(ke);async function Z(t){const r=await fe($(F,"leagues",t));return r.exists()?r.data():null}async function bt(){try{const t=await Ge(qe(F,"leagues")),r=[];return t.forEach(o=>{var a,d,n;const s=o.data();r.push({id:o.id,name:s.name||o.id,players:((a=s.players)==null?void 0:a.length)||0,matches:((d=s.matches)==null?void 0:d.length)||0,lastUpdated:s._updatedAt?new Date(s._updatedAt).toLocaleString():"N/A",courts:((n=s.courts)==null?void 0:n.length)||0})}),r.sort((o,s)=>(s._updatedAt||0)-(o._updatedAt||0))}catch(t){return console.error("Errore nel recupero della lista backup:",t),[]}}async function Se(t,r){var o,s,a,d,n;if(r._restored)console.log("🔥 Ripristino manuale autorizzato - bypassando protezioni");else if(r.players&&r.players.length<5){console.warn("🚨 PROTEZIONE ATTIVA: Rifiutato salvataggio di dati con pochi giocatori (possibili seed data)"),console.warn("Dati non salvati:",{players:(o=r.players)==null?void 0:o.length,matches:(s=r.matches)==null?void 0:s.length});return}try{const i=await Z(t);if(i&&i.players&&i.players.length>(((a=r.players)==null?void 0:a.length)||0)){const u=`firebase-backup-${Date.now()}`;localStorage.setItem(u,JSON.stringify({timestamp:new Date().toISOString(),data:i,reason:"Auto-backup before potential data loss"})),console.log("🔒 Backup automatico creato prima del salvataggio:",u)}}catch(i){console.warn("Impossibile creare backup automatico:",i)}await ge($(F,"leagues",t),r,{merge:!0}),console.log("✅ Dati salvati nel cloud:",{players:(d=r.players)==null?void 0:d.length,matches:(n=r.matches)==null?void 0:n.length})}function Ae(t,r){return Je($(F,"leagues",t),o=>{o.exists()&&r(o.data())})}const sr=Object.freeze(Object.defineProperty({__proto__:null,db:F,listLeagues:bt,loadLeague:Z,saveLeague:Se,subscribeLeague:Ae},Symbol.toStringTag,{value:"Module"})),z=t=>Math.round(Number(t||0)),q=t=>Number(t||0).toFixed(2);function wt(t){return(t||[]).filter(r=>String((r==null?void 0:r.a)??"")!==""||String((r==null?void 0:r.b)??"")!=="").map(r=>`${Number(r.a||0)}-${Number(r.b||0)}`).join(", ")}function J(t){let r=0,o=0,s=0,a=0;for(const n of t||[]){const i=Number((n==null?void 0:n.a)||0),u=Number((n==null?void 0:n.b)||0);String(i)===""&&String(u)===""||(s+=i,a+=u,i>u?r++:u>i&&o++)}let d=null;return r>o?d="A":o>r&&(d="B"),{setsA:r,setsB:o,gamesA:s,gamesB:a,winner:d}}function yt(t){return t<=-2e3?.4:t<=-1500?.6:t<=-900?.75:t<=-300?.9:t<300&&t>-300?1:t<=900?1.1:t<=1500?1.25:t<=2e3?1.4:1.6}function vt(t){return t<=-2e3?"gap ≤ −2000 ⇒ 0.40":t<=-1500?"−2000 < gap ≤ −1500 ⇒ 0.60":t<=-900?"−1500 < gap ≤ −900 ⇒ 0.75":t<=-300?"−900 < gap ≤ −300 ⇒ 0.90":t<300&&t>-300?"−300 < gap < +300 ⇒ 1.00":t<=900?"+300 ≤ gap ≤ +900 ⇒ 1.10":t<=1500?"+900 < gap ≤ +1500 ⇒ 1.25":t<=2e3?"+1500 < gap ≤ +2000 ⇒ 1.40":"gap ≥ +2000 ⇒ 1.60"}function K({ratingA1:t,ratingA2:r,ratingB1:o,ratingB2:s,gamesA:a,gamesB:d,winner:n,sets:i}){const u=Number(t||0),m=Number(r||0),f=Number(o||0),g=Number(s||0),l=u+m,c=f+g,p=n==="A"?l:c,w=n==="A"?c:l,h=(l+c)/100,k=w-p,N=yt(k),_=n==="A"?a-d:d-a,j=(h+_)*N,y=Math.round(j),A=n==="A"?y:-y,v=n==="B"?y:-y,x=`Risultato set: ${wt(i)}`,P=`Team A=${z(l)}, Team B=${z(c)}, Gap=${z(k)}
Fascia: ${vt(k)}

Base = (${z(l)} + ${z(c)})/100 = ${q(h)}
DG (Differenza Game) = ${_}

Punti = (Base + DG) × factor = (${q(h)} + ${_}) × ${N.toFixed(2)} = ${q(j)}
Punti (arrotondato) = ${y}
`+(n==="A"?`Team A +${y}, Team B -${y}`:`Team B +${y}, Team A -${y}`)+`
${x}`;return{deltaA:A,deltaB:v,pts:y,base:h,factor:N,gap:k,sumA:l,sumB:c,gd:_,formula:P}}const ar=()=>Math.random().toString(36).slice(2,10),I=1e3,T="paris-league-v1";function jt(t,r){const o=new Map(t.map(n=>{const i=Number(n.baseRating??n.startRating??n.rating??I);return[n.id,{...n,rating:i,wins:0,losses:0,lastDelta:0,trend5Total:0,trend5Pos:0,trend5Neg:0}]})),s=new Map(t.map(n=>[n.id,[]])),a=[],d=[...r||[]].sort((n,i)=>new Date(n.date)-new Date(i.date));for(const n of d){const i=o.get(n.teamA[0]),u=o.get(n.teamA[1]),m=o.get(n.teamB[0]),f=o.get(n.teamB[1]),g=J(n.sets),l=K({ratingA1:(i==null?void 0:i.rating)??I,ratingA2:(u==null?void 0:u.rating)??I,ratingB1:(m==null?void 0:m.rating)??I,ratingB2:(f==null?void 0:f.rating)??I,gamesA:g.gamesA,gamesB:g.gamesB,winner:g.winner,sets:n.sets}),c={...n,...g,...l};a.push(c);const p=(w,h)=>{if(!w)return;const k=s.get(w)||[];k.push(h),s.set(w,k)};p(i==null?void 0:i.id,l.deltaA),p(u==null?void 0:u.id,l.deltaA),p(m==null?void 0:m.id,l.deltaB),p(f==null?void 0:f.id,l.deltaB),i&&(i.lastDelta=l.deltaA),u&&(u.lastDelta=l.deltaA),m&&(m.lastDelta=l.deltaB),f&&(f.lastDelta=l.deltaB),g.winner==="A"?(i&&(i.rating+=l.deltaA),u&&(u.rating+=l.deltaA),m&&(m.rating+=l.deltaB),f&&(f.rating+=l.deltaB),i&&i.wins++,u&&u.wins++,m&&m.losses++,f&&f.losses++):g.winner==="B"&&(i&&(i.rating+=l.deltaA),u&&(u.rating+=l.deltaA),m&&(m.rating+=l.deltaB),f&&(f.rating+=l.deltaB),m&&m.wins++,f&&f.wins++,i&&i.losses++,u&&u.losses++)}for(const n of o.values()){const u=(s.get(n.id)||[]).slice(-5);let m=0,f=0,g=0;for(const l of u)g+=l,l>=0?m+=l:f+=-l;n.trend5Total=g,n.trend5Pos=m,n.trend5Neg=f}return{players:Array.from(o.values()),matches:a}}function nr(t,r,o){const s=new Map(t.map(c=>[c.id,c.name])),d=[...r||[]].sort((c,p)=>new Date(c.date)-new Date(p.date)).slice(-15),n=new Map(t.map(c=>[c.id,Number(c.rating??I)])),i=new Map(n),u=[...d].reverse();for(const c of u){const p=J(c.sets),w=K({ratingA1:i.get(c.teamA[0])??I,ratingA2:i.get(c.teamA[1])??I,ratingB1:i.get(c.teamB[0])??I,ratingB2:i.get(c.teamB[1])??I,gamesA:p.gamesA,gamesB:p.gamesB,winner:p.winner,sets:c.sets}),h=(k,N)=>i.set(k,(i.get(k)??I)-N);h(c.teamA[0],w.deltaA),h(c.teamA[1],w.deltaA),h(c.teamB[0],w.deltaB),h(c.teamB[1],w.deltaB)}const m=new Map(i),f=[],g={label:"Inizio periodo"};for(const c of o)g[s.get(c)||c]=Math.round(m.get(c)??I);f.push(g);for(const c of d){const p=J(c.sets),w=K({ratingA1:m.get(c.teamA[0])??I,ratingA2:m.get(c.teamA[1])??I,ratingB1:m.get(c.teamB[0])??I,ratingB2:m.get(c.teamB[1])??I,gamesA:p.gamesA,gamesB:p.gamesB,winner:p.winner,sets:c.sets}),h=(N,_)=>m.set(N,(m.get(N)??I)+_);h(c.teamA[0],w.deltaA),h(c.teamA[1],w.deltaA),h(c.teamB[0],w.deltaB),h(c.teamB[1],w.deltaB);const k={label:new Date(c.date).toLocaleString("it-IT",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})};for(const N of o)k[s.get(N)||N]=Math.round(m.get(N)??I);f.push(k)}const l={label:"Attuale"};for(const c of o)l[s.get(c)||c]=Math.round(n.get(c)??I);return f.push(l),f}function R(){return{slotMinutes:30,dayStartHour:8,dayEndHour:23,defaultDurations:[60,90,120],pricing:{full:[],discounted:[]},addons:{lightingEnabled:!0,lightingFee:2,heatingEnabled:!0,heatingFee:4},baseRateWeekday:24,baseRatePeak:32,baseRateWeekend:28,peakStartHour:17,peakEndHour:22}}function oe(){return{players:[],matches:[],courts:[],bookings:[],bookingConfig:R()}}const Ne=b.createContext(null),kt=()=>{const t=b.useContext(Ne);if(!t)throw new Error("useLeague must be used within a LeagueProvider");return t};function St({children:t}){const{user:r,loading:o}=G(),[s,a]=b.useState(null),[d,n]=b.useState(!0),[i,u]=b.useState(null),[m,f]=b.useState(!1),[g,l]=b.useState(localStorage.getItem(T+"-leagueId")||"lega-andrea-2025"),c=b.useRef(null);if(!c.current){const j=(()=>{try{return localStorage.getItem("ml-client-id")}catch{return null}})();if(j)c.current=j;else{const y=Math.random().toString(36).slice(2,10);c.current=y;try{localStorage.setItem("ml-client-id",y)}catch{}}}const p=b.useRef(0),w=b.useRef(null);b.useEffect(()=>{localStorage.setItem(T+"-leagueId",g)},[g]);const h=j=>{a(y=>{const A=typeof j=="function"?j(y):j,v=Date.now(),x=((y==null?void 0:y._rev)||0)+1;return p.current=v+2e3,{...A,_updatedAt:v,_rev:x,_lastWriter:c.current}})};b.useEffect(()=>{o||(async()=>{try{if(n(!0),u(null),r){const A=await Z(g);if(A&&typeof A=="object"&&Array.isArray(A.players)&&Array.isArray(A.matches)){const x={...A};Array.isArray(x.courts)||(x.courts=[]),Array.isArray(x.bookings)||(x.bookings=[]),x.bookingConfig||(x.bookingConfig=R()),x.bookingConfig.pricing||(x.bookingConfig.pricing=R().pricing),x.bookingConfig.addons||(x.bookingConfig.addons=R().addons),a(x);const P=["players","matches","courts","bookings","bookingConfig"];w.current=P.reduce((M,U)=>(M[U]=x[U],M),{});try{localStorage.setItem(T,JSON.stringify(x))}catch{}return}}try{const A=localStorage.getItem(T);if(A){const v=JSON.parse(A);if(v&&Array.isArray(v.players)&&Array.isArray(v.matches)){a(v);const x=["players","matches","courts","bookings","bookingConfig"];w.current=x.reduce((P,M)=>(P[M]=v[M]||[],P),{});return}}}catch{}const j=oe();a(j);const y=["players","matches","courts","bookings","bookingConfig"];w.current=y.reduce((A,v)=>(A[v]=j[v]||[],A),{}),console.log("� App inizializzata con stato vuoto - aggiungi i tuoi dati!");try{localStorage.setItem(T,JSON.stringify(j))}catch{}}catch(j){console.error("League load error:",j),u(j);const y=oe();a(y)}finally{n(!1)}})()},[g,r,o]),b.useEffect(()=>{if(!g||!r||o)return;let j=null;try{j=Ae(g,y=>{if(!(y&&typeof y=="object"&&Array.isArray(y.players)&&Array.isArray(y.matches))||Date.now()<p.current)return;const v={...y};Array.isArray(v.courts)||(v.courts=[]),Array.isArray(v.bookings)||(v.bookings=[]),v.bookingConfig||(v.bookingConfig=R()),v.bookingConfig.pricing||(v.bookingConfig.pricing=R().pricing),v.bookingConfig.addons||(v.bookingConfig.addons=R().addons),f(!0),a(x=>{const P=(x==null?void 0:x._rev)??0,M=(v==null?void 0:v._rev)??0,U=(x==null?void 0:x._updatedAt)??0,_e=(v==null?void 0:v._updatedAt)??0,ee=M>P||M===P&&_e>U;if(ee){const Be=["players","matches","courts","bookings","bookingConfig"];w.current=Be.reduce((te,re)=>(te[re]=v[re],te),{})}return ee?v:x}),f(!1)})}catch(y){console.error("Subscribe error:",y)}return()=>j&&j()},[g,r,o]),b.useEffect(()=>{if(!s||m||!r)return;const j=["players","matches","courts","bookings","bookingConfig"],y=j.reduce((x,P)=>(x[P]=s[P],x),{}),A=w.current;if(!A||j.some(x=>JSON.stringify(y[x])!==JSON.stringify(A[x])))try{localStorage.setItem(T,JSON.stringify(s));const x={...s,_updatedAt:Date.now(),_lastWriter:c.current,_rev:(s._rev||0)+1},P=setTimeout(async()=>{try{await Se(g,x),w.current=y}catch(M){console.error("Cloud save error:",M)}},800);return()=>clearTimeout(P)}catch(x){console.error("LocalStorage save error:",x)}},[s,g,m,r]);const k=C.useMemo(()=>s?jt(s.players||[],s.matches||[]):{players:[],matches:[]},[s]),N=C.useMemo(()=>Object.fromEntries((k.players||[]).map(j=>[j.id,j])),[k]),_={state:s,setState:h,derived:k,playersById:N,leagueId:g,setLeagueId:l,loading:d,error:i,updatingFromCloud:m};return e.jsx(Ne.Provider,{value:_,children:t})}const Ie=b.createContext(null),Ce=()=>{const t=b.useContext(Ie);if(!t)throw new Error("useUI must be used within a UIProvider");return t};function At({children:t}){const[r,o]=b.useState(()=>{try{const p=sessionStorage.getItem("ml-extra-unlocked")==="1",w=sessionStorage.getItem("ml-club-mode")==="1";return p&&w}catch{return!1}}),[s,a]=b.useState([]),[d,n]=b.useState(!1),[i,u]=b.useState(null);C.useEffect(()=>{try{r?sessionStorage.setItem("ml-club-mode","1"):sessionStorage.removeItem("ml-club-mode")}catch{}},[r]);const m=p=>{const w=Math.random().toString(36).slice(2),h={id:w,...p};return a(k=>[...k,h]),setTimeout(()=>{f(w)},5e3),w},f=p=>{a(w=>w.filter(h=>h.id!==p))},c={clubMode:r,setClubMode:o,notifications:s,addNotification:m,removeNotification:f,loading:d,setLoading:n,modal:i,showModal:p=>{u(p)},hideModal:()=>{u(null)}};return e.jsx(Ie.Provider,{value:c,children:t})}class Nt extends C.Component{constructor(r){super(r),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(r){return{hasError:!0}}componentDidCatch(r,o){this.setState({error:r,errorInfo:o})}render(){if(this.state.hasError){const{fallback:r}=this.props;return r?e.jsx(r,{error:this.state.error,resetError:()=>this.setState({hasError:!1,error:null,errorInfo:null})}):e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 max-w-md w-full",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-6 w-6 text-red-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),e.jsx("div",{className:"ml-3",children:e.jsx("h3",{className:"text-sm font-medium text-gray-800",children:"Oops! Qualcosa è andato storto"})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Si è verificato un errore imprevisto. Prova a ricaricare la pagina."}),!1]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>window.location.reload(),className:"flex-1 bg-blue-600 text-white px-4 py-2 rounded-md text-sm font-medium hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",children:"Ricarica Pagina"}),e.jsx("button",{onClick:()=>this.setState({hasError:!1,error:null,errorInfo:null}),className:"flex-1 bg-gray-300 text-gray-700 px-4 py-2 rounded-md text-sm font-medium hover:bg-gray-400 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2",children:"Riprova"})]})]})})}return this.props.children}}function Pe({size:t="md",className:r=""}){const o={sm:"h-4 w-4",md:"h-8 w-8",lg:"h-12 w-12",xl:"h-16 w-16"};return e.jsx("div",{className:`animate-spin rounded-full border-2 border-gray-300 border-t-blue-600 ${o[t]} ${r}`})}function Q({message:t="Caricamento..."}){return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Pe,{size:"xl",className:"mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 text-lg",children:t})]})})}function It({message:t="Caricamento...",visible:r=!0}){return r?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 flex items-center space-x-3",children:[e.jsx(Pe,{size:"md"}),e.jsx("span",{className:"text-gray-700",children:t})]})}):null}function Y(t,r,o){return t!==r}function Ct(t,r){var s,a;const o=t.pathname;if(o==="/login"){const d=(a=(s=t.state)==null?void 0:s.from)==null?void 0:a.pathname;return d&&d!=="/login"?d:"/dashboard"}return o==="/"?"/dashboard":null}function Pt({children:t,requireProfile:r=!0}){const{userProfile:o,isAuthenticated:s,isProfileComplete:a,loading:d}=G(),n=X();if(d)return e.jsx(Q,{message:"Verifica autenticazione..."});if(!s){const i="/login";if(Y(n.pathname,i))return e.jsx(W,{to:i,state:{from:n},replace:!0})}if(s&&r&&o!==null&&!a){const i="/profile";if(Y(n.pathname,i))return e.jsx(W,{to:i,state:{from:n},replace:!0})}return t}function Lt({children:t}){const{isAuthenticated:r,loading:o}=G(),s=X();if(o)return e.jsx(Q,{message:"Verifica autenticazione..."});if(r){const a=Ct(s);if(a&&Y(s.pathname,a))return e.jsx(W,{to:a,replace:!0})}return t}const Et=(t=!1)=>t?{bg:"bg-gray-900",bgSecondary:"bg-gray-800",bgTertiary:"bg-gray-700",cardBg:"bg-gray-800 border-gray-700",modalBg:"bg-gray-800",text:"text-white",textSecondary:"text-gray-200",textMuted:"text-gray-300",subtext:"text-gray-200",border:"border-gray-600",borderLight:"border-gray-700",input:"bg-gray-700 border-gray-600 text-white placeholder-gray-300 focus:border-blue-400 focus:ring-blue-400",button:"bg-blue-600 hover:bg-blue-500 text-white",buttonSecondary:"bg-gray-600 hover:bg-gray-500 text-white",success:"text-green-400",error:"text-red-400",warning:"text-yellow-400",info:"text-blue-400",shadow:"shadow-2xl shadow-black/40",divider:"border-gray-600"}:{bg:"bg-white",bgSecondary:"bg-gray-50",bgTertiary:"bg-gray-100",cardBg:"bg-white border-gray-200",modalBg:"bg-white",text:"text-gray-900",textSecondary:"text-gray-700",textMuted:"text-gray-500",subtext:"text-gray-600",border:"border-gray-200",borderLight:"border-gray-100",input:"bg-white border-gray-300 text-gray-900 placeholder-gray-400 focus:border-blue-500 focus:ring-blue-500",button:"bg-blue-600 hover:bg-blue-700 text-white",buttonSecondary:"bg-gray-100 hover:bg-gray-200 text-gray-900",success:"text-emerald-600",error:"text-red-600",warning:"text-amber-600",info:"text-blue-600",shadow:"shadow-lg shadow-gray-200/50",divider:"border-gray-200"},_t="/play-sport-pro_horizontal.svg",S={borderRadius:{sm:"rounded-lg",md:"rounded-xl",lg:"rounded-2xl",full:"rounded-full"},spacing:{xs:"p-2",sm:"p-3",md:"p-4",lg:"p-6",xl:"p-8"},shadows:{sm:"shadow-sm",md:"shadow-md",lg:"shadow-lg",card:"shadow-[0_0_0_1px_rgba(0,0,0,0.02)] shadow-sm"},transitions:{fast:"transition-all duration-150 ease-in-out",normal:"transition-all duration-200 ease-in-out",slow:"transition-all duration-300 ease-in-out"}};function Bt(t=!1){const r=Et(t);return{...r,borderSm:S.borderRadius.sm,borderMd:S.borderRadius.md,borderLg:S.borderRadius.lg,borderFull:S.borderRadius.full,spacingXs:S.spacing.xs,spacingSm:S.spacing.sm,spacingMd:S.spacing.md,spacingLg:S.spacing.lg,spacingXl:S.spacing.xl,shadowCard:t?"shadow-xl shadow-black/30":S.shadows.card,shadowSm:S.shadows.sm,shadowMd:S.shadows.md,shadowLg:S.shadows.lg,transitionFast:S.transitions.fast,transitionNormal:S.transitions.normal,transitionSlow:S.transitions.slow,focusRing:t?"focus:outline-none focus:ring-2 focus:ring-blue-400 focus:ring-offset-2 focus:ring-offset-slate-800":"focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",pageBg:r.bgSecondary,headerBg:r.cardBg,neonText:t?"text-emerald-400":"text-emerald-600",link:t?"underline underline-offset-4 decoration-blue-400 hover:text-blue-300":"underline underline-offset-4 decoration-blue-600 hover:text-blue-700",ghostRing:t?"ring-slate-600 hover:bg-slate-700":"ring-black/10 hover:bg-black/5",tableHeadText:r.textMuted,btnPrimary:`inline-flex items-center justify-center ${S.borderRadius.md} px-4 py-2 font-medium ${t?"bg-blue-600 hover:bg-blue-500 text-white":"bg-emerald-600 hover:bg-emerald-700 text-white"} ${S.transitions.normal} ${S.shadows.sm}`,btnGhost:`inline-flex items-center justify-center ${S.borderRadius.md} px-4 py-2 font-medium ${t?"ring-1 ring-slate-600 hover:bg-slate-700":"ring-1 ring-black/10 hover:bg-black/5"} ${S.transitions.normal}`,btnGhostSm:`inline-flex items-center justify-center ${S.borderRadius.sm} px-2 py-1 text-xs font-medium ${t?"ring-1 ring-slate-600 hover:bg-slate-700":"ring-1 ring-black/10 hover:bg-black/5"} ${S.transitions.normal}`,accentGood:r.success,accentBad:r.error,accentWarning:r.warning,accentInfo:r.info,successBg:t?"bg-emerald-900/20":"bg-emerald-50",errorBg:t?"bg-red-900/20":"bg-red-50",warningBg:t?"bg-amber-900/20":"bg-amber-50",infoBg:t?"bg-blue-900/20":"bg-blue-50",chip:t?"bg-blue-600 text-white":"bg-emerald-500 text-black",card:`${S.borderRadius.lg} ${r.cardBg} ${S.spacing.md} ${t?"shadow-xl shadow-black/30":S.shadows.card}`}}function Mt(){const{notifications:t,removeNotification:r}=Ce();return t.length===0?null:e.jsx("div",{className:"fixed top-4 right-4 z-50 space-y-2",children:t.map(o=>e.jsx(Rt,{notification:o,onRemove:r},o.id))})}function Rt({notification:t,onRemove:r}){const{id:o,type:s="info",title:a,message:d,autoClose:n=!0}=t,i={success:"bg-green-500 text-white",error:"bg-red-500 text-white",warning:"bg-yellow-500 text-black",info:"bg-blue-500 text-white"},u={success:"✅",error:"❌",warning:"⚠️",info:"ℹ️"};return C.useEffect(()=>{if(n){const m=setTimeout(()=>{r(o)},5e3);return()=>clearTimeout(m)}},[o,n,r]),e.jsx("div",{className:`${i[s]} px-4 py-3 rounded-lg shadow-lg max-w-sm animate-slide-in-right`,role:"alert",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("span",{className:"text-lg mr-2",children:u[s]}),e.jsxs("div",{className:"flex-1",children:[a&&e.jsx("div",{className:"font-medium",children:a}),d&&e.jsx("div",{className:"text-sm opacity-90",children:d})]}),e.jsx("button",{onClick:()=>r(o),className:"ml-2 text-lg leading-none opacity-70 hover:opacity-100","aria-label":"Chiudi notifica",children:"×"})]})})}function Tt({active:t,setActive:r,clubMode:o,T:s,user:a,navigation:d}){const n=d||[{id:"classifica",label:"Classifica"},{id:"stats",label:"Statistiche"},{id:"prenota-campo",label:"Prenota Campo"},...o?[{id:"giocatori",label:"Giocatori"},{id:"crea",label:"Crea Partita"},{id:"prenota",label:"Gestione Campi"},{id:"tornei",label:"Crea Tornei"}]:[],{id:a?"profile":"auth",label:a?"Profilo":"Accedi"},{id:"extra",label:"Extra"}];return e.jsx("nav",{className:"hidden md:flex gap-1",children:n.map(i=>e.jsx("button",{type:"button",onClick:()=>r(i.id),className:`px-3 py-1.5 rounded-xl text-sm transition ring-1 ${t===i.id?s.btnPrimary:s.ghostRing}`,"aria-current":t===i.id?"page":void 0,children:i.label},i.id))})}function zt({active:t,setActive:r,navigation:o=[],clubMode:s=!1}){const[a,d]=b.useState(!1),n=[{id:"dashboard",label:"Home",path:"/dashboard",icon:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"})})},{id:"prenota-campo",label:"Prenota",path:"/booking",icon:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})})},{id:"classifica",label:"Classifica",path:"/classifica",icon:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"})})},{id:"stats",label:"Statistiche",path:"/stats",icon:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})})}],i=[{id:"giocatori",label:"Giocatori",path:"/players",icon:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"})})},{id:"crea",label:"Crea Partita",path:"/matches/create",icon:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4"})})},{id:"prenota",label:"Gestione Campi",path:"/booking-admin",icon:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-4m-5 0H9m0 0H5m4 0v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})})},{id:"tornei",label:"Crea Tornei",path:"/tournaments",icon:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})},{id:"profile",label:"Profilo",path:"/profile",icon:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})},{id:"extra",label:"Extra",path:"/extra",icon:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4"})})}],u=n,m=l=>{r(l.id),a&&d(!1)},f=l=>{l.stopPropagation(),l.preventDefault(),d(!a)},g=(l,c)=>{c.stopPropagation(),c.preventDefault(),r(l.id),d(!1)};return e.jsxs("div",{className:"md:hidden bottom-nav-container bg-white border-t border-gray-200",style:{zIndex:999999,paddingBottom:"env(safe-area-inset-bottom)",height:"calc(64px + env(safe-area-inset-bottom))"},onClick:l=>l.stopPropagation(),onTouchEnd:l=>l.stopPropagation(),children:[a&&e.jsx("div",{className:"club-menu-container absolute bottom-full left-0 right-0 bg-white border-t border-gray-200 shadow-lg",style:{zIndex:1e6},children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("div",{className:"text-sm font-medium text-gray-500",children:"Menu Circolo"}),e.jsx("button",{onClick:f,className:"text-gray-400 hover:text-gray-600 p-1",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:i.map(l=>e.jsxs("div",{className:`flex items-center space-x-2 p-2.5 rounded-lg cursor-pointer transition-colors ${t===l.id?"bg-blue-50 text-blue-600":"text-gray-700 hover:bg-gray-50"}`,onClick:c=>g(l,c),style:{WebkitTapHighlightColor:"rgba(0,0,0,0)",WebkitTouchCallout:"none",WebkitUserSelect:"none",userSelect:"none"},children:[l.icon,e.jsx("span",{className:"text-xs font-medium",children:l.label})]},l.id))})]})}),e.jsxs("div",{className:`grid h-16 ${s?"grid-cols-5":"grid-cols-4"}`,children:[u.map(l=>e.jsxs("div",{className:`bottom-nav-item flex flex-col items-center justify-center space-y-1 ${t===l.id?"text-blue-600 bg-blue-50":"text-gray-600"}`,onClick:()=>m(l),onTouchEnd:()=>m(l),style:{WebkitTapHighlightColor:"rgba(0,0,0,0)",WebkitTouchCallout:"none",WebkitUserSelect:"none",userSelect:"none",minHeight:"48px",position:"relative",zIndex:1e6},children:[l.icon,e.jsx("span",{className:"font-medium text-xs",children:l.label})]},l.id)),s&&e.jsxs("div",{className:`bottom-nav-item flex flex-col items-center justify-center space-y-1 cursor-pointer ${a?"text-blue-600 bg-blue-50":"text-gray-600"}`,onClick:f,style:{WebkitTapHighlightColor:"rgba(0,0,0,0)",WebkitTouchCallout:"none",WebkitUserSelect:"none",userSelect:"none",minHeight:"48px",position:"relative",zIndex:1e6},children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})}),e.jsx("span",{className:"text-xs font-medium",children:"Menu"})]})]})]})}function Le(){const[t,r]=b.useState(null),[o,s]=b.useState(!1),[a,d]=b.useState(!1),[n,i]=b.useState({});b.useEffect(()=>{(()=>{const h=navigator.userAgent,k=/iPad|iPhone|iPod/.test(h),N=/Android/.test(h),_=k||N||/Mobile|Tablet/.test(h),j=/Chrome/.test(h)&&!/Edge|Edg/.test(h),y=/Edge|Edg/.test(h),A=/Firefox/.test(h),v=/Safari/.test(h)&&!/Chrome|CriOS|FxiOS/.test(h),x=/OPR|Opera/.test(h),P=/SamsungBrowser/.test(h);i({isIOS:k,isAndroid:N,isMobile:_,isChrome:j,isEdge:y,isFirefox:A,isSafari:v,isOpera:x,isSamsung:P,supportsInstallPrompt:j||y||P||x})})(),(()=>{const h=window.matchMedia("(display-mode: standalone)").matches,k=window.navigator.standalone===!0,N=window.matchMedia("(display-mode: fullscreen)").matches,_=window.matchMedia("(display-mode: minimal-ui)").matches,j=h||k||N||_;d(j),j&&console.log("✅ PWA is already installed")})();const p=h=>{console.log("🚀 PWA installation prompt ready"),h.preventDefault(),r(h),s(!0)},w=()=>{console.log("✅ PWA installed successfully"),d(!0),s(!1),r(null),localStorage.setItem("pwa_installed","true")};return n.supportsInstallPrompt&&(window.addEventListener("beforeinstallprompt",p),window.addEventListener("appinstalled",w)),()=>{window.removeEventListener("beforeinstallprompt",p),window.removeEventListener("appinstalled",w)}},[n.supportsInstallPrompt]);const u=async()=>{if(!t)return console.warn("⚠️ No deferred prompt available"),!1;try{t.prompt();const{outcome:l}=await t.userChoice;return l==="accepted"?(console.log("✅ User accepted PWA installation"),s(!1),r(null),!0):(console.log("❌ User declined PWA installation"),!1)}catch(l){return console.error("❌ PWA installation failed:",l),!1}},m=()=>{const{isIOS:l,isAndroid:c,isSafari:p,isFirefox:w,isChrome:h,isEdge:k}=n;return l&&p?{show:!0,title:"Installa su iPhone/iPad",icon:"📱",instructions:["Tocca il pulsante Condividi in basso",'Scorri verso il basso e tocca "Aggiungi alla schermata Home"',`Tocca "Aggiungi" nell'angolo in alto a destra`,"L'app apparirà nella tua home screen"]}:w?{show:!0,title:"Installa con Firefox",icon:"🦊",instructions:c?["Tocca il menu (3 punti) in alto a destra",'Seleziona "Installa"','Conferma toccando "Aggiungi"']:["Clicca sull'icona più (+) nella barra degli indirizzi",'Seleziona "Installa questa app"','Conferma cliccando "Installa"']}:c&&(h||k)?{show:!0,title:"Installa su Android",icon:"🤖",instructions:["Tocca il menu (3 punti) in alto a destra",'Seleziona "Installa app" o "Aggiungi alla schermata Home"','Conferma toccando "Installa"',"L'app verrà aggiunta alla home screen"]}:!n.isMobile&&(h||k)?{show:!0,title:"Installa sul Desktop",icon:"💻",instructions:[`Clicca sull'icona "Installa" nella barra degli indirizzi`,'Oppure apri il menu (3 punti) → "Installa Paris League"','Conferma cliccando "Installa"',"L'app apparirà nel menu Start/Applicazioni"]}:{show:!1,instructions:[]}},f=()=>"serviceWorker"in navigator&&"Cache"in window&&"caches"in window&&"PushManager"in window;return{isInstallable:a?!1:!!(n.isIOS&&n.isSafari||o&&t||n.isFirefox),isInstalled:a,installApp:u,browserInfo:n,isPWASupported:f(),installInstructions:m()}}function Ot({className:t=""}){const{isInstallable:r,isInstalled:o,installApp:s,browserInfo:a,isPWASupported:d,installInstructions:n}=Le(),[i,u]=b.useState(!1);if(o)return e.jsxs("div",{className:`flex items-center gap-2 text-green-600 text-sm ${t}`,children:[e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"})}),"App già installata"]});if(!d)return e.jsx("div",{className:`text-gray-500 text-sm ${t}`,children:"Browser non supportato per PWA"});if(!r)return null;const m=async()=>{if(n.show){u(!0);return}try{await s()||n.show&&u(!0)}catch(g){console.error("Install failed:",g),n.show&&u(!0)}},f=()=>a.isIOS?"📱 Installa su iPhone":a.isAndroid?"🤖 Installa su Android":a.isFirefox?"🦊 Installa con Firefox":"💻 Installa App";return e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:m,className:`flex items-center gap-2 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white px-4 py-3 rounded-xl text-sm font-medium transition-all duration-200 shadow-lg hover:shadow-xl transform hover:scale-105 ${t}`,children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"})}),f()]}),i&&n.show&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[99999] p-4",children:e.jsx("div",{className:"bg-white rounded-2xl p-6 max-w-md w-full mx-4 shadow-2xl",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-100 rounded-2xl flex items-center justify-center mx-auto mb-4",children:e.jsx("span",{className:"text-3xl",children:n.icon})}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:n.title}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Segui questi semplici passaggi per installare Paris League:"}),e.jsx("div",{className:"text-left space-y-4 mb-8",children:n.instructions.map((g,l)=>e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-full flex items-center justify-center text-sm font-bold flex-shrink-0",children:l+1}),e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"text-gray-700 leading-relaxed",children:g})})]},l))}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-3 mb-6",children:e.jsxs("p",{className:"text-xs text-gray-600 text-center",children:["Browser rilevato: ",a.isChrome?"Chrome":a.isFirefox?"Firefox":a.isEdge?"Edge":a.isSafari?"Safari":a.isOpera?"Opera":a.isSamsung?"Samsung Internet":"Altro",a.isMobile&&" Mobile"]})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>u(!1),className:"flex-1 bg-gray-100 hover:bg-gray-200 text-gray-800 py-3 px-4 rounded-xl font-medium transition-colors",children:"Chiudi"}),!a.isIOS&&!a.isFirefox&&e.jsx("button",{onClick:async()=>{u(!1),await s()},className:"flex-1 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white py-3 px-4 rounded-xl font-medium transition-all shadow-lg",children:"Prova Auto-Install"})]})]})})})]})}function Wt(){const{isInstallable:t,isInstalled:r,installApp:o,browserInfo:s,installInstructions:a}=Le(),[d,n]=b.useState(!1),[i,u]=b.useState(!1);if(r||!t)return null;const m=async()=>{if(a&&a.show){n(!0);return}try{await o()}catch(g){console.error("Install failed:",g),a&&a.show&&n(!0)}},f=()=>s&&s.isIOS?"📱 Installa":s&&s.isAndroid?"🤖 Installa":"Installa App";return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"sm:hidden fixed right-4 bottom-20 z-[9999]",children:i?e.jsx("button",{onClick:()=>u(!1),className:"w-12 h-12 bg-blue-600 hover:bg-blue-700 text-white rounded-full shadow-lg flex items-center justify-center backdrop-blur-sm",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"})})}):e.jsxs("div",{className:"flex items-center bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-full shadow-lg backdrop-blur-sm",children:[e.jsxs("button",{onClick:m,className:"flex items-center gap-2 px-4 py-3 text-sm font-medium",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"})}),f()]}),e.jsx("button",{onClick:()=>u(!0),className:"px-3 py-3 text-white/70 hover:text-white border-l border-white/20",children:e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),d&&a&&a.show&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[99999] p-4",children:e.jsx("div",{className:"bg-white rounded-xl p-6 max-w-sm w-full mx-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("span",{className:"text-2xl",children:a.icon||"📱"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:a.title||"Installa App"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Segui questi passaggi per installare l'app:"}),a.instructions&&e.jsx("div",{className:"text-left space-y-3 mb-6",children:a.instructions.map((g,l)=>e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-6 h-6 bg-blue-600 text-white rounded-full flex items-center justify-center text-xs font-bold flex-shrink-0",children:l+1}),e.jsx("p",{className:"text-sm text-gray-700",children:g})]},l))}),e.jsxs("div",{className:"space-y-2",children:[s&&!s.isIOS&&!s.isFirefox&&e.jsx("button",{onClick:async()=>{n(!1),await o()},className:"w-full bg-blue-600 hover:bg-blue-700 text-white py-3 px-4 rounded-lg font-medium transition-colors",children:"Prova Auto-Install"}),e.jsx("button",{onClick:()=>n(!1),className:"w-full bg-gray-100 hover:bg-gray-200 text-gray-800 py-2 px-4 rounded-lg font-medium transition-colors text-sm",children:"Ho capito"})]})]})})})]})}function $t(){var l;const{user:t}=G(),{clubMode:r,loading:o}=Ce(),{updatingFromCloud:s}=kt(),a=X(),d=Ke(),n=C.useMemo(()=>Bt(),[]),i=[{id:"dashboard",label:"Dashboard",path:"/dashboard",public:!0},{id:"classifica",label:"Classifica",path:"/classifica",public:!0},{id:"stats",label:"Statistiche",path:"/stats",public:!0},{id:"prenota-campo",label:"Prenota Campo",path:"/booking",public:!0},...r?[{id:"giocatori",label:"Giocatori",path:"/players",club:!0},{id:"crea",label:"Crea Partita",path:"/matches/create",club:!0},{id:"prenota",label:"Gestione Campi",path:"/admin/bookings",club:!0},{id:"tornei",label:"Crea Tornei",path:"/tournaments",club:!0}]:[],{id:t?"profile":"auth",label:t?"Profilo":"Accedi",path:t?"/profile":"/login"},{id:"extra",label:"Extra",path:"/extra",public:!0}],u=a.pathname,m=((l=i.find(c=>c.path===u))==null?void 0:l.id)||"",f=c=>{const p=i.find(w=>w.id===c);p&&d(p.path)},g=u==="/dashboard"||u==="/";return e.jsxs("div",{className:`min-h-screen ${n.text} ${g?"bg-gradient-to-b from-neutral-50 via-white to-neutral-100":n.pageBg}`,children:[e.jsx("header",{className:`sticky top-0 z-20 ${n.headerBg}`,children:e.jsxs("div",{className:"max-w-6xl mx-auto px-3 sm:px-4 py-3 flex items-center justify-between gap-2",children:[e.jsx("div",{className:"flex items-center gap-2 sm:gap-3 min-w-0",children:e.jsx("img",{src:_t,alt:"Play-Sport.pro",className:"h-10 w-auto shrink-0"})}),e.jsxs("div",{className:"flex items-center gap-2 overflow-x-auto no-scrollbar",children:[e.jsx("div",{className:"hidden sm:block",children:e.jsx(Ot,{className:"text-xs px-3 py-1.5"})}),e.jsx(Tt,{active:m,setActive:f,clubMode:r,T:n,user:t,navigation:i})]})]})}),e.jsx("main",{className:"max-w-6xl mx-auto px-3 sm:px-4 py-5 sm:py-6 pb-20 md:pb-5",children:e.jsx(Ye,{})}),e.jsx(zt,{active:m,setActive:f,navigation:i,clubMode:r}),e.jsx(Wt,{}),e.jsx(Mt,{}),e.jsx(It,{visible:o||s,message:s?"Sincronizzazione...":"Caricamento..."})]})}const Dt=C.lazy(()=>B(()=>import("./LoginPage-DuNkjnPi.js"),__vite__mapDeps([0,1,2,3,4]))),Ft=C.lazy(()=>B(()=>import("./DashboardPage-BOBpys0_.js"),__vite__mapDeps([5,1,3,6,7,4,8]))),Ut=C.lazy(()=>B(()=>import("./ClassificaPage-hcFXV6sc.js"),__vite__mapDeps([9,1,2,10,11,4,3]))),Vt=C.lazy(()=>B(()=>import("./StatsPage-PtMUzmiF.js"),__vite__mapDeps([12,1,2,11,10,8,13,4,3]))),Ht=C.lazy(()=>B(()=>import("./BookingPage-D_OXFsHV.js"),__vite__mapDeps([14,1,6,7,3,4,15]))),Gt=C.lazy(()=>B(()=>import("./PlayersPage-237ViPKA.js"),__vite__mapDeps([16,1,2,13,4,3]))),qt=C.lazy(()=>B(()=>import("./MatchesPage-KGbMqGXg.js"),__vite__mapDeps([17,1,2,13,18,3,4]))),Jt=C.lazy(()=>B(()=>import("./TournamentsPage-CijueSuR.js"),__vite__mapDeps([19,1,2,4,3]))),Kt=C.lazy(()=>B(()=>import("./ProfilePage-FNvKZIRc.js"),__vite__mapDeps([20,1,2,8,21,22,7,3,4,23]))),Yt=C.lazy(()=>B(()=>import("./ExtraPage-CNxXoFUx.js"),__vite__mapDeps([24,1,21,2,22,3,4]))),Xt=C.lazy(()=>B(()=>import("./AdminBookingsPage-BA1FhRrJ.js"),__vite__mapDeps([25,1,2,8,22,15,4,3])));function Zt(){return e.jsx(Nt,{children:e.jsx(Xe,{children:e.jsx(pt,{children:e.jsx(St,{children:e.jsx(At,{children:e.jsx(b.Suspense,{fallback:e.jsx(Q,{}),children:e.jsxs(Ze,{children:[e.jsx(E,{path:"/login",element:e.jsx(Lt,{children:e.jsx(Dt,{})})}),e.jsxs(E,{path:"/",element:e.jsx(Pt,{children:e.jsx($t,{})}),children:[e.jsx(E,{index:!0,element:e.jsx(W,{to:"dashboard",replace:!0})}),e.jsx(E,{path:"dashboard",element:e.jsx(Ft,{})}),e.jsx(E,{path:"classifica",element:e.jsx(Ut,{})}),e.jsx(E,{path:"stats",element:e.jsx(Vt,{})}),e.jsx(E,{path:"booking",element:e.jsx(Ht,{})}),e.jsx(E,{path:"extra",element:e.jsx(Yt,{})}),e.jsx(E,{path:"players",element:e.jsx(Gt,{})}),e.jsx(E,{path:"matches/create",element:e.jsx(qt,{})}),e.jsx(E,{path:"tournaments",element:e.jsx(Jt,{})}),e.jsx(E,{path:"admin/bookings",element:e.jsx(Xt,{})}),e.jsx(E,{path:"profile",element:e.jsx(Kt,{})})]}),e.jsx(E,{path:"*",element:e.jsx(W,{to:"/dashboard",replace:!0})})]})})})})})})})}"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then(t=>{console.log("✅ SW registered: ",t),t.addEventListener("updatefound",()=>{const r=t.installing;r.addEventListener("statechange",()=>{r.state==="installed"&&navigator.serviceWorker.controller&&console.log("🔄 New content available! Please refresh.")})})}).catch(t=>{console.log("❌ SW registration failed: ",t)})});const Ee=document.getElementById("root");if(!Ee)throw new Error("Elemento #root non trovato in index.html");xe(Ee).render(e.jsx(C.StrictMode,{children:e.jsx(Zt,{})}));export{I as D,_t as L,Ot as P,B as _,lt as a,ct as b,gt as c,ht as d,F as e,Le as f,kt as g,nr as h,J as i,e as j,ar as k,ft as l,Ce as m,vt as n,L as o,we as p,R as q,yt as r,H as s,Bt as t,G as u,rr as v,sr as w};
