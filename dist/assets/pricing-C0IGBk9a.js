const b=(t="00:00")=>{const[e,n]=String(t).split(":").map(s=>+s||0);return e*60+n},p=t=>t.getDay(),D=t=>t.getHours()*60+t.getMinutes();function M(t,e,n){if(!e)return!1;const s=D(t),l=s>=b(e.from)&&s<b(e.to),r=Array.isArray(e.days)?e.days.includes(p(t)):!0,o=Array.isArray(e.courts)&&e.courts.length?e.courts.includes(n):!0;return l&&r&&o}function H(t,e,n){const s=n==null?void 0:n.find(i=>i.id===e);if(!(s!=null&&s.timeSlots))return null;const l=t.getDay(),r=t.getHours()*60+t.getMinutes();return s.timeSlots.find(i=>{var d;if(!((d=i.days)!=null&&d.includes(l)))return!1;const a=b(i.from),u=b(i.to);return r>=a&&r<u})}function k(t,e,n,s=null){const l=s||(e==null?void 0:e.courts)||[],r=H(t,n,l);if(r)return{rate:Number(r.eurPerHour||r.price)||0,source:"court-slot",slot:r,isPromo:!!r.isPromo};const o=(e==null?void 0:e.pricing)||{},i=(o.discounted||[]).find(y=>M(t,y,n));if(i)return{rate:Number(i.eurPerHour)||0,source:"legacy",rule:i,isPromo:!1};const a=(o.full||[]).find(y=>M(t,y,n));if(a)return{rate:Number(a.eurPerHour)||0,source:"legacy",rule:a,isPromo:!1};const u=t.getHours(),d=t.getDay()===0||t.getDay()===6,h=u>=((e==null?void 0:e.peakStartHour)||17)&&u<((e==null?void 0:e.peakEndHour)||22);let m=(e==null?void 0:e.baseRateWeekday)||20;return d?m=(e==null?void 0:e.baseRateWeekend)||25:h&&(m=(e==null?void 0:e.baseRatePeak)||28),{rate:m,source:"base",rule:null,isPromo:!1}}function S(t,e,n,s={},l,r=null){const o=Math.max(5,Number(n==null?void 0:n.slotMinutes)||30),i=Math.ceil(e/o);let a=new Date(t),u=0;const d=r||(n==null?void 0:n.courts)||[],h=d.find(y=>y.id===l);for(let y=0;y<i;y++){const{rate:P}=k(a,n,l,d);u+=P*o/60,a=new Date(a.getTime()+o*60*1e3)}const m=(n==null?void 0:n.addons)||{};return s.lighting&&m.lightingEnabled&&(u+=Number(m.lightingFee||0)),s.heating&&(h!=null&&h.hasHeating)&&m.heatingEnabled&&(u+=Number(m.heatingFee||0)),Math.round(u*100)/100}export{S as c,k as g};
